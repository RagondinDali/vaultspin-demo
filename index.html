<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>VaultSpin – Booster Plante</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050608;
      --panel: #0f172a;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.14);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
      --card-radius: 18px;
      --transition-fast: 150ms ease-out;
      --transition: 220ms ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 35%, #020617 100%);
      color: var(--text);
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .page {
      max-width: 1120px;
      width: 100%;
      padding: 24px;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.6rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #a5b4fc;
    }

    h2 {
      margin: 0 0 8px;
      font-size: 1.2rem;
    }

    p {
      margin: 0;
    }

    .subtitle {
      font-size: 0.95rem;
      color: var(--muted);
      margin-bottom: 16px;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 18px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: radial-gradient(circle at top left, #0b1020, #020617 60%);
      border-radius: 22px;
      padding: 18px 18px 16px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow:
        0 18px 60px rgba(15, 23, 42, 0.8),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(34, 197, 94, 0.12), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(56, 189, 248, 0.12), transparent 55%);
      opacity: 0.45;
      pointer-events: none;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      position: relative;
      z-index: 1;
    }

    .panel-header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #4ade80;
      box-shadow: 0 0 8px rgba(74, 222, 128, 0.9);
    }

    .tag-ghost {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #f97316;
      box-shadow: 0 0 8px rgba(249, 115, 22, 0.8);
    }

    .actions {
      display: flex;
      gap: 8px;
      position: relative;
      z-index: 1;
    }

    button {
      border-radius: 999px;
      border: none;
      outline: none;
      font-size: 0.9rem;
      padding: 9px 14px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast), opacity 80ms linear;
    }

    button:disabled {
      cursor: default;
      opacity: 0.55;
      transform: none;
      box-shadow: none;
    }

    .btn-primary {
      background: linear-gradient(120deg, #16a34a, #22c55e);
      color: #ecfdf5;
      box-shadow:
        0 10px 32px rgba(34, 197, 94, 0.5),
        0 0 0 1px rgba(21, 128, 61, 0.9);
    }

    .btn-primary:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow:
        0 16px 38px rgba(34, 197, 94, 0.68),
        0 0 0 1px rgba(21, 128, 61, 1);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .btn-secondary:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow:
        0 12px 28px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.8);
    }

    .status-text {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .status-error {
      color: var(--danger);
    }

    .status-ok {
      color: #4ade80;
    }

    .main-content {
      position: relative;
      z-index: 1;
      margin-top: 8px;
      display: flex;
      gap: 16px;
    }

    .main-content-left {
      flex: 1.25;
    }

    .main-content-right {
      flex: 0.9;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (max-width: 900px) {
      .main-content {
        flex-direction: column;
      }
    }

    /* Booster + Card area */

    .pack-area {
      margin-top: 10px;
      padding: 16px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #052e16, #020617 70%);
      border: 1px solid rgba(34, 197, 94, 0.35);
      min-height: 260px;
      position: relative;
      overflow: hidden;
    }

    .pack-area-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #bbf7d0;
      margin-bottom: 4px;
    }

    .pack-area-sub {
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .pack-visual-wrapper {
      position: relative;
      width: 100%;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Booster */

    .booster {
      width: 150px;
      height: 210px;
      border-radius: 16px;
      background: radial-gradient(circle at top, #22c55e, #166534 48%, #052e16 100%);
      box-shadow:
        0 18px 40px rgba(22, 163, 74, 0.75),
        0 0 0 2px rgba(21, 128, 61, 0.9);
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transform-origin: center center;
      transition: opacity 120ms linear;
    }

    .booster-label {
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: #ecfdf5;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
    }

    .booster::after {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 20% 0%, rgba(255, 255, 255, 0.25), transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(190, 242, 100, 0.25), transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.85;
    }

    .booster.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* Booster split animation (commune à toutes les raretés) */

    .booster-split {
      animation: boosterSplit 0.8s ease-in-out forwards;
    }

    @keyframes boosterSplit {
      0% {
        transform: scale(1) translateY(0);
        box-shadow:
          0 18px 40px rgba(22, 163, 74, 0.8),
          0 0 0 2px rgba(21, 128, 61, 0.9);
      }
      30% {
        transform: scaleY(0.9) scaleX(1.02) translateY(-4px);
        box-shadow:
          0 26px 60px rgba(22, 163, 74, 0.9),
          0 0 0 2px rgba(21, 128, 61, 1);
      }
      55% {
        transform: scaleY(0.6) scaleX(1.05) translateY(12px);
        box-shadow:
          0 32px 56px rgba(22, 163, 74, 0.6),
          0 0 0 2px rgba(21, 128, 61, 0.7);
      }
      100% {
        transform: scaleY(0.1) scaleX(1.08) translateY(40px);
        opacity: 0;
        box-shadow:
          0 40px 72px rgba(22, 163, 74, 0),
          0 0 0 0 rgba(21, 128, 61, 0);
      }
    }

    /* Booster aura selon rareté */

    .booster-common {
      box-shadow:
        0 16px 40px rgba(34, 197, 94, 0.7),
        0 0 0 1px rgba(22, 163, 74, 0.9);
    }

    .booster-rare {
      box-shadow:
        0 18px 48px rgba(59, 130, 246, 0.8),
        0 0 0 1px rgba(37, 99, 235, 0.9);
    }

    .booster-ultra {
      box-shadow:
        0 18px 54px rgba(168, 85, 247, 0.9),
        0 0 0 1px rgba(147, 51, 234, 1);
      animation: boosterUltraPulse 1s ease-out infinite alternate;
    }

    @keyframes boosterUltraPulse {
      0% {
        filter: drop-shadow(0 0 8px rgba(168, 85, 247, 0.6));
      }
      100% {
        filter: drop-shadow(0 0 20px rgba(168, 85, 247, 1));
      }
    }

    .booster-legendary {
      box-shadow:
        0 20px 60px rgba(250, 204, 21, 0.95),
        0 0 0 1px rgba(234, 179, 8, 1);
      animation: boosterLegendaryBurst 0.9s ease-out infinite alternate;
    }

    @keyframes boosterLegendaryBurst {
      0% {
        filter: drop-shadow(0 0 10px rgba(250, 250, 46, 0.7));
      }
      100% {
        filter: drop-shadow(0 0 28px rgba(250, 250, 21, 1));
      }
    }

    /* Card */

    .card-slot {
      position: absolute;
      width: 180px;
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .card-outer {
      width: 180px;
      height: 240px;
      border-radius: var(--card-radius);
      background: radial-gradient(circle at top, #0f172a, #020617 70%);
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow:
        0 20px 54px rgba(15, 23, 42, 0.85),
        0 0 0 1px rgba(30, 64, 175, 0.9);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding: 10px 10px 8px;
      pointer-events: auto;
    }

    .card-outer::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(96, 165, 250, 0.28), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(52, 211, 153, 0.22), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.8;
      pointer-events: none;
    }

    .card-rarity-pill {
      align-self: flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.8);
      color: var(--muted);
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    .card-image {
      flex: 1;
      border-radius: 12px;
      background: radial-gradient(circle at top, #22c55e, #15803d 60%, #052e16 100%);
      border: 1px solid rgba(34, 197, 94, 0.6);
      box-shadow:
        inset 0 0 16px rgba(15, 23, 42, 0.9),
        0 12px 32px rgba(21, 128, 61, 0.9);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding: 10px;
    }

    .card-name {
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #ecfdf5;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
    }

    .card-footer {
      margin-top: 8px;
      font-size: 0.75rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-token-id {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo,
        Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.7rem;
      color: #cbd5f5;
    }

    /* Card rarity FX */

    .card-common {
      animation: cardCommonIn 0.35s ease-out;
    }

    @keyframes cardCommonIn {
      0% {
        transform: scale(0.9) translateY(12px);
        opacity: 0;
      }
      100% {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .card-rare .card-image {
      border-color: rgba(59, 130, 246, 0.9);
      box-shadow:
        inset 0 0 18px rgba(15, 23, 42, 0.95),
        0 14px 34px rgba(59, 130, 246, 0.85);
    }

    .card-rare {
      animation: cardRareIn 0.45s ease-out;
    }

    @keyframes cardRareIn {
      0% {
        transform: scale(0.8) rotate(-2deg);
        opacity: 0;
        filter: blur(6px);
      }
      60% {
        transform: scale(1.03) rotate(1deg);
        opacity: 1;
        filter: blur(0);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }

    .card-ultra .card-image {
      border-color: rgba(168, 85, 247, 0.9);
      box-shadow:
        inset 0 0 22px rgba(15, 23, 42, 0.98),
        0 16px 40px rgba(168, 85, 247, 0.95);
    }

    .card-ultra {
      animation: cardUltraIn 0.55s ease-out;
    }

    @keyframes cardUltraIn {
      0% {
        transform: scale(0.7) rotate(-4deg) translateY(24px);
        opacity: 0;
      }
      40% {
        transform: scale(1.08) rotate(3deg) translateY(-6px);
        opacity: 1;
      }
      100% {
        transform: scale(1) rotate(0deg) translateY(0);
      }
    }

    .card-legendary .card-image {
      border-color: rgba(250, 204, 21, 0.95);
      box-shadow:
        inset 0 0 26px rgba(15, 23, 42, 1),
        0 18px 46px rgba(250, 204, 21, 1);
    }

    .card-legendary {
      animation: cardLegendaryIn 0.55s cubic-bezier(0.18, 0.89, 0.43, 1.4);
    }

    @keyframes cardLegendaryIn {
      0% {
        transform: scale(0.6) rotate(0deg);
        opacity: 0;
      }
      40% {
        transform: scale(1.09) rotate(3deg);
        opacity: 1;
      }
      60% {
        transform: scale(0.96) rotate(-1deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }

    .card-legendary::after {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 50% 0%, rgba(250, 250, 46, 0.55), transparent 60%),
        radial-gradient(circle at 0% 100%, rgba(252, 211, 77, 0.4), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(252, 211, 77, 0.5), transparent 55%);
      mix-blend-mode: screen;
      pointer-events: none;
      opacity: 0.9;
      animation: legendaryRays 1.2s ease-out forwards;
    }

    @keyframes legendaryRays {
      0% {
        transform: rotate(0deg);
        opacity: 0;
      }
      100% {
        transform: rotate(12deg);
        opacity: 1;
      }
    }

    /* Transfer animation vers "Ma Collection" */

    .card-transfer {
      animation: cardToCollection 0.9s cubic-bezier(0.16, 0.84, 0.44, 1) forwards;
    }

    @keyframes cardToCollection {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      50% {
        transform: translate(140px, -40px) scale(0.9);
        opacity: 0.9;
      }
      100% {
        transform: translate(260px, -80px) scale(0.7);
        opacity: 0;
      }
    }

    /* Right column */

    .side-section {
      background: rgba(15, 23, 42, 0.92);
      border-radius: 16px;
      padding: 12px 14px 11px;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .side-section h3 {
      margin: 0 0 6px;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #e5e7eb;
    }

    .side-section p {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .collection-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      color: #a5b4fc;
      margin-top: 6px;
      cursor: default;
    }

    .collection-link span {
      opacity: 0.7;
    }

    .rarity-list {
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .rarity-row {
      display: flex;
      justify-content: space-between;
      padding: 2px 0;
    }

    .rarity-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .rarity-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #22c55e;
    }

    .rarity-dot.rare {
      background: #3b82f6;
    }

    .rarity-dot.ultra {
      background: #a855f7;
    }

    .rarity-dot.legendary {
      background: #facc15;
    }

    .last-nft-box {
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.18), #020617);
      border: 1px dashed rgba(148, 163, 184, 0.8);
      font-size: 0.8rem;
    }

    .last-nft-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .last-nft-content {
      color: #e5e7eb;
    }

    .last-nft-muted {
      color: var(--muted);
      font-size: 0.78rem;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 0.74rem;
      color: var(--muted);
    }

    .accent {
      color: #bbf7d0;
      font-weight: 500;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>VAULTSPIN · SEPOLIA TESTNET</h1>
      <div class="subtitle">
        Connecte ton wallet, clique sur <strong>Open VaultSpin Pack</strong> et reçois un vrai NFT (contrat Sepolia).  
        L’ouverture du pack se fait <span class="accent">carte par carte</span>, au rythme de tes clics.
      </div>
    </header>

    <div class="layout">
      <!-- LEFT PANEL: PACK + CARD -->
      <section class="panel">
        <div class="panel-header">
          <div class="panel-header-left">
            <div class="tag">
              <span class="tag-dot"></span>
              <span>Open your VaultSpin Pack</span>
            </div>
            <div class="status-text" id="connection-status">
              Wallet non connecté.
            </div>
            <div class="status-text" id="network-status">
              Réseau attendu : <span class="accent">Sepolia</span>
            </div>
            <div class="status-text">
              Contrat : <span class="mono">0x0003…9ED7</span>
            </div>
          </div>
          <div class="actions">
            <button id="connect-btn" class="btn-secondary">
              Connecter wallet
            </button>
            <button id="open-pack-btn" class="btn-primary">
              Open VaultSpin Pack
            </button>
          </div>
        </div>

        <div class="status-text" style="margin-top: 4px;">
          Si tu n’as pas MetaMask : installe l’extension, ajoute le réseau Sepolia et recharge la page.
        </div>

        <div class="panel-header" style="margin-top: 14px;">
          <div class="panel-header-left">
            <h2 style="font-size: 1rem; margin-bottom: 2px;">VaultSpin Pack – Booster Plante</h2>
            <p class="status-text">
              1 carte <span class="accent">Bulbizarre / Herbizarre / Florizarre</span> à révéler.
            </p>
          </div>
        </div>

        <div class="main-content">
          <div class="main-content-left">
            <div class="pack-area">
              <div class="pack-area-title">Pack en cours</div>
              <div class="pack-area-sub">
                Clique sur <strong>Open VaultSpin Pack</strong> pour ouvrir le booster.  
                Quand une carte est visible, le <span class="accent">prochain clic</span> l’enverra vers ta collection.
              </div>

              <div class="pack-visual-wrapper">
                <!-- Booster -->
                <div id="booster" class="booster">
                  <div class="booster-label">Booster Plante</div>
                </div>

                <!-- Card slot -->
                <div id="card-slot" class="card-slot"></div>
              </div>
            </div>
          </div>

          <div class="main-content-right">
            <div class="side-section">
              <h3 id="collection-target">Ma collection (bientôt)</h3>
              <p>
                Les cartes que tu révèles glissent ici visuellement avant d’être
                ajoutées dans ta véritable collection on-chain.
              </p>
              <div class="collection-link">
                <span>→ Flux actuel :</span>
                <span>Carte visible → clic → transfert → nouveau booster</span>
              </div>
            </div>

            <div class="side-section">
              <h3>Drop table du booster</h3>
              <div class="rarity-list">
                <div class="rarity-row">
                  <div class="rarity-label">
                    <span class="rarity-dot"></span>
                    <span>Common</span>
                  </div>
                  <span>70%</span>
                </div>
                <div class="rarity-row">
                  <div class="rarity-label">
                    <span class="rarity-dot rare"></span>
                    <span>Rare</span>
                  </div>
                  <span>20%</span>
                </div>
                <div class="rarity-row">
                  <div class="rarity-label">
                    <span class="rarity-dot ultra"></span>
                    <span>Ultra</span>
                  </div>
                  <span>9%</span>
                </div>
                <div class="rarity-row">
                  <div class="rarity-label">
                    <span class="rarity-dot legendary"></span>
                    <span>Legendary</span>
                  </div>
                  <span>1%</span>
                </div>
              </div>
            </div>

            <div class="side-section last-nft-box">
              <div class="last-nft-title">Dernier NFT reçu</div>
              <div id="last-nft" class="last-nft-content last-nft-muted">
                En attente d’un mint… ouvre un pack pour voir la carte ici.
              </div>
            </div>
          </div>
        </div>

        <div class="footer-note">
          L’ouverture est volontairement <span class="accent">rythmée par ton clic</span> :
          la carte reste immobile jusqu’à ce que tu recliques sur <strong>Open VaultSpin Pack</strong>.
        </div>
      </section>

      <!-- RIGHT SIDE: EXPLANATIONS / HELP -->
      <section class="panel">
        <div class="panel-header">
          <div class="panel-header-left">
            <div class="tag">
              <span class="tag-ghost"></span>
              <span>Comment ça s’ouvre ?</span>
            </div>
          </div>
        </div>

        <div class="side-section" style="margin-bottom: 10px;">
          <h3>Flow d’ouverture (state machine)</h3>
          <p style="margin-bottom: 4px;">
            Le bouton <strong>Open VaultSpin Pack</strong> se comporte comme suit :
          </p>
          <ul style="margin: 4px 0 0 18px; padding: 0; font-size: 0.8rem; color: var(--muted);">
            <li><strong>Pas de carte visible</strong> → le booster apparaît &amp; se fend (split).</li>
            <li><strong>Nouvelle carte révélée</strong> → elle reste immobile, tu peux la regarder.</li>
            <li><strong>Clic suivant</strong> → la carte glisse vers “Ma collection”, puis un nouveau booster s’ouvre.</li>
          </ul>
        </div>

        <div class="side-section">
          <h3>Raretés &amp; FX visuels</h3>
          <p>
            Les cartes <span class="accent">Rare</span>, <span class="accent">Ultra</span> et
            <span class="accent">Legendary</span> déclenchent des FX supplémentaires :
          </p>
          <ul style="margin: 4px 0 0 18px; padding: 0; font-size: 0.8rem; color: var(--muted);">
            <li><strong>Common</strong> → entrée simple.</li>
            <li><strong>Rare</strong> → flash + zoom léger.</li>
            <li><strong>Ultra</strong> → shake + aura violette.</li>
            <li><strong>Legendary</strong> → éclat doré + burst d’énergie.</li>
          </ul>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ---------------------------------------------------------------------------
    //  Simple front-end state machine for the pack opening flow
    //
    //  States (conceptually):
    //    - IDLE:       aucun booster ouvert, aucune carte visible
    //    - REVEALING:  animation en cours (split booster + apparition carte)
    //    - CARD_SHOWN: une carte est visible, on attend un clic pour l’envoyer
    //    - TRANSFER:   animation de transfert vers "Ma collection"
    //
    //  handleOpenPackClick() gère tout :
    //    - si carte visible → transfert + nouveau booster
    //    - sinon          → nouveau booster direct
    //
    //  NOTE IMPORTANTE :
    //  Ici, la fonction mintAndFetchCard() est MOCK (random).
    //  Tu peux la remplacer facilement par ton appel réel au contrat Sepolia.
    // ---------------------------------------------------------------------------

    const connectBtn = document.getElementById("connect-btn");
    const openPackBtn = document.getElementById("open-pack-btn");
    const boosterEl = document.getElementById("booster");
    const cardSlotEl = document.getElementById("card-slot");
    const connectionStatusEl = document.getElementById("connection-status");
    const lastNftEl = document.getElementById("last-nft");

    const state = {
      isConnected: false,
      isAnimating: false,
      cardVisible: false,
      lastCardData: null,
      lastCardElement: null,
      lastTokenId: null,
      clickCounter: 0
    };

    // ---------------------------------------------------------------------------
    // MOCK: wallet connect (UI only)
    // ---------------------------------------------------------------------------

    connectBtn.addEventListener("click", async () => {
      if (state.isConnected) return;
      // Ici tu peux intégrer ton vrai flow de connexion MetaMask.
      state.isConnected = true;
      connectionStatusEl.textContent = "Wallet connecté (mock).";
      connectionStatusEl.classList.remove("status-error");
      connectionStatusEl.classList.add("status-ok");
    });

    // ---------------------------------------------------------------------------
    // MAIN: handle open pack
    // ---------------------------------------------------------------------------

    openPackBtn.addEventListener("click", () => {
      handleOpenPackClick();
    });

    async function handleOpenPackClick() {
      if (state.isAnimating) return;

      // Cas 1 : une carte est affichée → on la transfère vers "Ma Collection" d'abord
      if (state.cardVisible && state.lastCardElement) {
        await transferCurrentCardThenOpenNew();
      } else {
        // Cas 2 : aucune carte → on ouvre directement un nouveau booster
        await openNewBoosterAndRevealCard();
      }
    }

    async function transferCurrentCardThenOpenNew() {
      if (!state.lastCardElement) return;

      state.isAnimating = true;

      // Animation CSS vers "Ma collection"
      state.lastCardElement.classList.add("card-transfer");

      // Après 900ms (durée de l'animation CSS), on nettoie + nouveau booster
      await waitMs(900);

      // Retirer l’ancienne carte du slot
      if (cardSlotEl.contains(state.lastCardElement)) {
        cardSlotEl.removeChild(state.lastCardElement);
      }
      state.cardVisible = false;
      state.lastCardElement = null;
      state.lastCardData = null;

      await openNewBoosterAndRevealCard();
    }

    async function openNewBoosterAndRevealCard() {
      state.isAnimating = true;
      state.clickCounter += 1;

      boosterEl.classList.remove("hidden");
      boosterEl.classList.remove(
        "booster-common",
        "booster-rare",
        "booster-ultra",
        "booster-legendary"
      );

      // On fait le mint / random draw pendant que le booster se prépare.
      const cardData = await mintAndFetchCard();
      const rarity = cardData.rarity;

      // Appliquer aura booster selon rareté
      if (rarity === "common") {
        boosterEl.classList.add("booster-common");
      } else if (rarity === "rare") {
        boosterEl.classList.add("booster-rare");
      } else if (rarity === "ultra") {
        boosterEl.classList.add("booster-ultra");
      } else if (rarity === "legendary") {
        boosterEl.classList.add("booster-legendary");
      }

      // Lancer l’animation de split du booster
      boosterEl.classList.remove("booster-split"); // reset éventuel
      void boosterEl.offsetWidth; // force reflow pour redémarrer l'animation
      boosterEl.classList.add("booster-split");

      // À la fin du split (~800ms), on cache le booster et on montre la carte.
      await waitMs(800);
      boosterEl.classList.add("hidden");
      boosterEl.classList.remove("booster-split");

      const cardEl = renderCard(cardData);
      state.cardVisible = true;
      state.lastCardData = cardData;
      state.lastCardElement = cardEl;
      state.isAnimating = false;

      updateLastNftUI(cardData);
    }

    // ---------------------------------------------------------------------------
    // MOCK: mint + card data
    //
    // À remplacer par ton vrai appel de contrat :
    //   1) transaction openPack()
    //   2) récupération du tokenId
    //   3) récupération du tokenURI + metadata
    //   4) construction de l’objet cardData
    // ---------------------------------------------------------------------------

    async function mintAndFetchCard() {
      // Petit délai pour simuler un mint (aucun RPC ici)
      await waitMs(200);

      const roll = Math.random() * 100;
      let rarity = "common";

      if (roll < 1) rarity = "legendary";
      else if (roll < 10) rarity = "ultra";
      else if (roll < 30) rarity = "rare";
      else rarity = "common";

      const namesByRarity = {
        common: ["Bulbizarre", "Herbizarre", "Florizarre"],
        rare: ["Bulbizarre", "Herbizarre", "Florizarre"],
        ultra: ["Bulbizarre", "Herbizarre", "Florizarre"],
        legendary: ["Plante Légendaire"]
      };

      const pool = namesByRarity[rarity];
      const name = pool[Math.floor(Math.random() * pool.length)];

      // Token id mock (tu pourras utiliser le vrai)
      const tokenId = (state.clickCounter + "-" + Math.floor(Math.random() * 9999)).toString();

      return {
        name,
        rarity,     // "common" | "rare" | "ultra" | "legendary"
        tokenId,
        image: null // tu peux plugger le vrai URL d’image ici depuis le metadata
      };
    }

    // ---------------------------------------------------------------------------
    // RENDER CARD
    // ---------------------------------------------------------------------------

    function renderCard(cardData) {
      // Clean previous card DOM just in case
      cardSlotEl.innerHTML = "";

      const wrapper = document.createElement("div");
      wrapper.className = "card-outer";

      // Rareté → classes et label
      let rarityLabel = "COMMON";
      let rarityClass = "card-common";

      if (cardData.rarity === "rare") {
        rarityLabel = "RARE";
        rarityClass = "card-rare";
      } else if (cardData.rarity === "ultra") {
        rarityLabel = "ULTRA";
        rarityClass = "card-ultra";
      } else if (cardData.rarity === "legendary") {
        rarityLabel = "LEGENDARY";
        rarityClass = "card-legendary";
      }

      wrapper.classList.add(rarityClass);

      const rarityPill = document.createElement("div");
      rarityPill.className = "card-rarity-pill";
      rarityPill.textContent = rarityLabel;

      const imageDiv = document.createElement("div");
      imageDiv.className = "card-image";

      const nameSpan = document.createElement("div");
      nameSpan.className = "card-name";
      nameSpan.textContent = cardData.name;

      imageDiv.appendChild(nameSpan);

      const footer = document.createElement("div");
      footer.className = "card-footer";

      const leftFooter = document.createElement("span");
      leftFooter.textContent = "VaultSpin • Booster Plante";

      const idSpan = document.createElement("span");
      idSpan.className = "card-token-id";
      idSpan.textContent = "#" + (cardData.tokenId ?? "?");

      footer.appendChild(leftFooter);
      footer.appendChild(idSpan);

      wrapper.appendChild(rarityPill);
      wrapper.appendChild(imageDiv);
      wrapper.appendChild(footer);

      cardSlotEl.appendChild(wrapper);
      return wrapper;
    }

    function updateLastNftUI(cardData) {
      if (!cardData) {
        lastNftEl.textContent =
          "En attente d’un mint… ouvre un pack pour voir la carte ici.";
        lastNftEl.classList.add("last-nft-muted");
        return;
      }

      lastNftEl.classList.remove("last-nft-muted");
      lastNftEl.innerHTML =
        `<strong>${cardData.name}</strong> • ` +
        `${cardData.rarity.toUpperCase()} • ` +
        `<span class="mono">#${cardData.tokenId}</span>`;
    }

    function waitMs(ms) {
      return new Promise((resolve) => setTimeout(resolve, ms));
    }
  </script>
</body>
</html>
