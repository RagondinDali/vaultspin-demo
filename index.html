<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>VaultSpin ‚Äì Booster Plante (V10 ‚Äì Roulette CS:GO)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="animations.css" />

    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }
      body{
        min-height:100vh; display:flex; align-items:center; justify-content:center;
        background:radial-gradient(circle at top,#101827,#020617 60%);
        font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
        color:#e5e7eb;
      }

      .page{
        width:100%; max-width:1200px;
        padding:96px 16px 40px;
        display:flex; flex-direction:column; gap:24px;
      }
      @media (min-width: 900px){ .page{ flex-direction:row; gap:36px; } }

      .left-panel,.right-panel{
        background:radial-gradient(circle at top left,#020617,#020617 70%);
        border-radius:28px;
        border:1px solid rgba(148,163,184,.20);
        padding:22px 22px 24px;
      }
      .left-panel{ flex:1.25; display:flex; flex-direction:column; gap:16px; }
      .right-panel{ flex:1; display:flex; flex-direction:column; gap:18px; }

      h1{
        font-size:28px; font-weight:650; letter-spacing:.08em; text-transform:uppercase;
        color:#f9fafb;
      }
      .subtitle{ font-size:14px; color:#9ca3af; max-width:560px; line-height:1.45; }

      .tag{
        display:inline-flex; align-items:center; gap:8px;
        border-radius:999px; border:1px solid rgba(148,163,184,.30);
        padding:5px 10px;
        font-size:10px; letter-spacing:.16em; text-transform:uppercase;
        background:radial-gradient(circle at top,#111827,#020617 70%);
      }

      .btn-row{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
      .btn-primary{
        border-radius:999px; padding:10px 18px;
        font-size:13px; letter-spacing:.14em; text-transform:uppercase;
        border:none; cursor:pointer;
        display:inline-flex; align-items:center; gap:8px; white-space:nowrap;
        background:radial-gradient(circle at top left,#a855f7,#4f46e5);
        color:#f9fafb; box-shadow:0 0 18px rgba(168,85,247,.45);
        transition:transform .15s ease-out, box-shadow .15s ease-out, opacity .15s ease-out;
      }
      .btn-primary:hover{ transform:translateY(-1px); box-shadow:0 0 22px rgba(168,85,247,.65); }
      .btn-primary:disabled{ opacity:.45; cursor:default; box-shadow:none; }

      .status-line{
        font-size:13px; color:#e5e7eb;
        background:rgba(15,23,42,.55);
        border-radius:999px; padding:8px 14px;
        border:1px solid rgba(148,163,184,.22);
        display:inline-flex; align-items:center; gap:8px;
      }
      .status-dot{ width:8px; height:8px; border-radius:999px; background:#22c55e; }
      .status-dot.error{ background:#f97373; }
      .status-dot.pending{ background:#facc15; }

      .caption{ font-size:12px; color:#9ca3af; line-height:1.4; }

      /* ‚úÖ Stats (plus clean) */
      .stats{
        margin-top:4px;
        padding:12px;
        border-radius:20px;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(15,23,42,.35);
        display:grid;
        grid-template-columns: repeat(4, 1fr);
        gap:10px;
      }
      @media (max-width: 720px){ .stats{ grid-template-columns: repeat(2, 1fr); } }

      .stat{
        border-radius:16px;
        border:1px solid rgba(148,163,184,.14);
        background:rgba(2,6,23,.32);
        padding:10px 10px;
        min-height:66px;
      }
      .stat .k{ font-size:10px; letter-spacing:.16em; text-transform:uppercase; color:#9ca3af; }
      .stat .v{ margin-top:5px; font-size:16px; font-weight:850; color:#f9fafb; }
      .stat .s{ margin-top:2px; font-size:11px; color:#9ca3af; }

      /* ‚úÖ Best pull block (miniature + date) */
      .best-pull{
        display:flex; align-items:center; gap:10px; margin-top:5px;
      }
      .best-thumb{
        width:34px; height:34px; border-radius:10px; overflow:hidden;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(15,23,42,.45);
        flex:0 0 auto;
      }
      .best-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
      .best-meta{ display:flex; flex-direction:column; gap:1px; }
      .best-meta .line1{ font-size:12px; font-weight:800; color:#f9fafb; }
      .best-meta .line2{ font-size:11px; color:#9ca3af; }

      /* ‚úÖ Mini timeline */
      .history{
        margin-top:6px;
        padding:12px;
        border-radius:20px;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(2,6,23,.24);
      }
      .history-title{
        font-size:10px; letter-spacing:.18em; text-transform:uppercase; color:#9ca3af;
        display:flex; justify-content:space-between; align-items:center; gap:10px;
        margin-bottom:10px;
      }
      .history-clear{
        font-size:10px; letter-spacing:.14em; text-transform:uppercase;
        border-radius:999px; padding:6px 10px;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(15,23,42,.40);
        color:#e5e7eb;
        cursor:pointer;
      }
      .history-clear:hover{
        border-color: rgba(165,180,252,.65);
        box-shadow: 0 0 10px rgba(129,140,248,.25);
      }
      .history-list{
        display:flex; flex-direction:column; gap:8px;
        max-height:200px; overflow:auto; padding-right:4px;
      }
      .hist-item{
        display:flex; align-items:center; gap:10px;
        border-radius:14px;
        border:1px solid rgba(148,163,184,.14);
        background:rgba(15,23,42,.28);
        padding:8px 10px;
        cursor:default;
      }
      .hist-dot{
        width:10px; height:10px; border-radius:999px; background:#facc15;
        flex:0 0 auto;
        box-shadow:0 0 14px rgba(250,204,21,.25);
      }
      .hist-dot.rare{ background:#38bdf8; box-shadow:0 0 14px rgba(56,189,248,.25); }
      .hist-dot.ultra{ background:#a855f7; box-shadow:0 0 14px rgba(168,85,247,.25); }
      .hist-dot.legendary{ background:#f97316; box-shadow:0 0 16px rgba(249,115,22,.28); }

      .hist-main{ display:flex; flex-direction:column; gap:1px; min-width:0; }
      .hist-line1{
        font-size:12px; font-weight:800; color:#f9fafb;
        display:flex; gap:8px; align-items:center; min-width:0;
      }
      .pill-mini{
        font-size:10px; letter-spacing:.12em; text-transform:uppercase;
        padding:4px 8px; border-radius:999px;
        border:1px solid rgba(148,163,184,.18);
        background:rgba(2,6,23,.35);
        color:#e5e7eb;
        flex:0 0 auto;
      }
      .hist-line2{ font-size:11px; color:#9ca3af; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

      .hist-tools{
        margin-left:auto; display:flex; gap:8px; align-items:center;
      }
      .hist-open{
        font-size:10px; letter-spacing:.14em; text-transform:uppercase;
        border-radius:999px; padding:6px 10px;
        border:1px solid rgba(148,163,184,.18);
        background:rgba(15,23,42,.35);
        color:#e5e7eb;
        cursor:pointer;
      }
      .hist-open:hover{
        border-color: rgba(165,180,252,.65);
        box-shadow: 0 0 10px rgba(129,140,248,.25);
      }

      /* Right: card zone */
      .card-zone{
        width:100%; min-height:420px;
        border-radius:28px;
        border:1px dashed rgba(148,163,184,.30);
        background:radial-gradient(circle at top,#0b1120,#020617 70%);
        display:flex; align-items:center; justify-content:center;
        padding:28px 16px;
        position:relative;
        overflow:hidden;
      }

      .fx-overlay{
        position:absolute; inset:0;
        pointer-events:none;
        opacity:0;
      }
      .fx-overlay.on{ opacity:1; animation:fxFade 700ms ease-out forwards; }
      @keyframes fxFade{ 0%{opacity:0;} 20%{opacity:1;} 100%{opacity:0;} }
      .fx-overlay.common{ background:radial-gradient(circle at center,rgba(250,204,21,.14),transparent 55%); }
      .fx-overlay.rare{ background:radial-gradient(circle at center,rgba(56,189,248,.14),transparent 55%); }
      .fx-overlay.ultra{ background:radial-gradient(circle at center,rgba(168,85,247,.16),transparent 55%); }
      .fx-overlay.legendary{ background:radial-gradient(circle at center,rgba(249,115,22,.18),transparent 55%); }

      .card-frame{
        position:relative;
        width:260px; height:380px;
        border-radius:24px;
        padding:2px;
        transition:transform .25s ease-out, box-shadow .25s ease-out, background .2s ease-out;
      }
      .card-frame.state-closed{
        background:radial-gradient(circle at top,#22c55e,#064e3b 70%);
        box-shadow:0 0 36px rgba(34,197,94,.45);
      }
      .card-frame.state-opened{
        background:radial-gradient(circle at top,#facc15,#4b5563 70%);
        box-shadow:0 0 40px rgba(250,204,21,.40);
      }
      .card-frame.opening{
        animation:cardPulse .7s ease-in-out infinite alternate;
      }
      @keyframes cardPulse{
        from{ transform:translateY(0) scale(1); box-shadow:0 0 18px rgba(250,204,21,.25); }
        to{ transform:translateY(-4px) scale(1.02); box-shadow:0 0 34px rgba(250,204,21,.45); }
      }
      .card-inner{
        position:relative;
        width:100%; height:100%;
        border-radius:22px;
        overflow:hidden;
      }

      .hidden{ display:none; }

      .card-opened{
        width:100%; height:100%;
        border-radius:22px;
        background:radial-gradient(circle at top,#020617,#020617 65%);
        display:flex; flex-direction:column; justify-content:space-between;
        transform-origin:center;
      }

      .imgwrap{ flex:1; display:flex; align-items:center; justify-content:center; padding:18px 18px 8px; position:relative; }
      .imgwrap img{
        max-width:100%; max-height:100%;
        border-radius:16px; display:block;
        border:1px solid rgba(148,163,184,.18);
      }

      /* ‚úÖ Mystery overlay (NO blur, no leak) */
      .mystery-cover{
        position:absolute;
        inset:18px 18px 8px;
        border-radius:16px;
        display:none;
        border:1px solid rgba(148,163,184,.16);
        background:
          radial-gradient(circle at top, rgba(255,255,255,.08), rgba(0,0,0,.55) 70%),
          linear-gradient(90deg, rgba(255,255,255,.04), rgba(255,255,255,.10), rgba(255,255,255,.04));
        overflow:hidden;
      }
      .mystery-cover.on{ display:block; }
      .mystery-shimmer{
        position:absolute; inset:0;
        transform:translateX(-18%);
        animation:shimmer 900ms ease-in-out infinite;
        background:linear-gradient(90deg, transparent, rgba(255,255,255,.10), transparent);
      }
      @keyframes shimmer{
        0%{ transform:translateX(-30%); opacity:.65; }
        50%{ transform:translateX(30%); opacity:1; }
        100%{ transform:translateX(-30%); opacity:.65; }
      }

      /* flip */
      .flip{ animation:flip 420ms ease-out; }
      @keyframes flip{
        0%{ transform:rotateY(0deg); }
        50%{ transform:rotateY(85deg); }
        100%{ transform:rotateY(0deg); }
      }

      .card-footer{
        padding:12px 18px 16px;
        display:flex; justify-content:space-between; align-items:center;
        font-size:11px; letter-spacing:.16em; text-transform:uppercase;
        color:#f9fafb;
      }
      .card-footer-left{ opacity:.9; }
      .card-footer-right{ font-weight:700; }
      .token-id{ opacity:.8; }

      .rarity-common{ color:#facc15; }
      .rarity-rare{ color:#38bdf8; }
      .rarity-ultra{ color:#a855f7; }
      .rarity-legendary{ color:#f97316; }

      .card-frame.state-opened[data-rarity="COMMON"]{ background:radial-gradient(circle at top,#facc15,#4b5563 70%); box-shadow:0 0 34px rgba(250,204,21,.35); }
      .card-frame.state-opened[data-rarity="RARE"]{ background:radial-gradient(circle at top,#38bdf8,#4b5563 70%); box-shadow:0 0 34px rgba(56,189,248,.35); }
      .card-frame.state-opened[data-rarity="ULTRA"]{ background:radial-gradient(circle at top,#a855f7,#4b5563 70%); box-shadow:0 0 34px rgba(168,85,247,.35); }
      .card-frame.state-opened[data-rarity="LEGENDARY"]{ background:radial-gradient(circle at top,#f97316,#4b5563 70%); box-shadow:0 0 40px rgba(249,115,22,.40); }

      .card-opened.transfer-to-collection{ animation:toCollection .9s ease-in forwards; }
      @keyframes toCollection{
        0%{ transform:translate(0,0) scale(1); opacity:1; }
        60%{ transform:translate(80px,-80px) scale(.9); opacity:.9; }
        100%{ transform:translate(150px,-140px) scale(.75); opacity:0; }
      }

      /* Loot table */
      .drop-table{
        margin-top:10px;
        padding:16px 18px 18px;
        border-radius:24px;
        border:1px solid rgba(148,163,184,.22);
        background:radial-gradient(circle at top left,#020617,#020617 70%);
        display:flex; flex-direction:column; gap:12px;
      }
      .drop-title{
        font-size:11px; letter-spacing:.18em; text-transform:uppercase;
        color:#9ca3af; text-align:center;
      }

      .drop-grid{ display:grid; grid-template-columns: repeat(7, 1fr); gap:14px; justify-items:center; }
      @media (max-width: 1080px){ .drop-grid{ grid-template-columns: repeat(6, 1fr); } }
      @media (max-width: 900px){ .drop-grid{ grid-template-columns: repeat(5, 1fr); } }
      @media (max-width: 740px){ .drop-grid{ grid-template-columns: repeat(4, 1fr); } }

      .drop-item{
        width:92px;
        display:flex; flex-direction:column; align-items:center; gap:6px;
        text-align:center;
        cursor:pointer;
        user-select:none;
      }
      .drop-thumb{
        width:78px; height:100px;
        border-radius:14px;
        overflow:hidden;
        border:1px solid rgba(148,163,184,.22);
        background:#020617;
        transition:transform .16s ease-out, box-shadow .16s ease-out;
      }
      .drop-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
      .drop-name{
        font-size:10px; letter-spacing:.10em; text-transform:uppercase;
        color:#e5e7eb;
      }
      .drop-meta{ font-size:9px; color:#9ca3af; display:flex; flex-direction:column; gap:2px; }
      .drop-tag{ letter-spacing:.14em; text-transform:uppercase; font-weight:700; }
      .drop-tag.common{ color:#facc15; }
      .drop-tag.rare{ color:#38bdf8; }
      .drop-tag.ultra{ color:#a855f7; }
      .drop-tag.legendary{ color:#f97316; }

      .drop-item[data-rarity="COMMON"]:hover .drop-thumb{ transform:translateY(-2px) scale(1.04); box-shadow:0 0 14px rgba(250,204,21,.35); }
      .drop-item[data-rarity="RARE"]:hover .drop-thumb{ transform:translateY(-2px) scale(1.04); box-shadow:0 0 14px rgba(56,189,248,.35); }
      .drop-item[data-rarity="ULTRA"]:hover .drop-thumb{ transform:translateY(-2px) scale(1.04); box-shadow:0 0 16px rgba(168,85,247,.38); }
      .drop-item[data-rarity="LEGENDARY"]:hover .drop-thumb{ transform:translateY(-2px) scale(1.04); box-shadow:0 0 18px rgba(249,115,22,.42); }

      /* Top bar */
      .top-bar{
        position:fixed; top:16px; left:50%;
        transform:translateX(-50%);
        width:100%; max-width:1200px;
        display:flex; justify-content:space-between; align-items:center;
        padding:0 16px;
        pointer-events:none;
        z-index:50;
      }
      .top-left,.top-right{ display:flex; align-items:center; gap:12px; pointer-events:auto; }

      .top-logo{
        font-size:12px; letter-spacing:.22em; text-transform:uppercase;
        color:#9ca3af;
      }
      .top-link{
        font-size:12px; padding:6px 10px;
        border-radius:999px;
        border:1px solid rgba(148,163,184,.45);
        color:#e5e7eb; text-decoration:none;
        letter-spacing:.14em; text-transform:uppercase;
        background:rgba(15,23,42,.85);
      }
      .top-link:hover{ border-color:#a5b4fc; box-shadow:0 0 10px rgba(129,140,248,.4); }

      /* Wallet (‚àû) */
      .wallet-wrap{ position:relative; }
      .wallet-pill{
        display:inline-flex; align-items:center; gap:10px;
        border-radius:999px;
        padding:6px 12px;
        background:radial-gradient(circle at top,#020617,#020617 70%);
        border:1px solid rgba(148,163,184,.45);
        cursor:default;
      }
      .wallet-label{ font-size:10px; letter-spacing:.18em; text-transform:uppercase; color:#9ca3af; }
      .wallet-main{ font-size:12px; font-weight:800; color:#f9fafb; }
      .wallet-sub{ font-size:10px; color:#9ca3af; }

      .wallet-pop{
        position:absolute; right:0; top:44px;
        width:260px;
        border-radius:18px;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(2,6,23,.92);
        backdrop-filter:blur(10px);
        padding:12px;
        display:none;
        box-shadow:0 0 24px rgba(0,0,0,.35);
      }
      .wallet-wrap:hover .wallet-pop{ display:block; }

      .wallet-pop h3{
        margin:0 0 8px 0;
        font-size:11px; letter-spacing:.18em; text-transform:uppercase;
        color:#cbd5e1;
      }
      .wallet-hint{ margin-top:8px; font-size:11px; color:#9ca3af; line-height:1.35; }

      .btn-mini{
        border-radius:999px;
        padding:9px 12px;
        font-size:11px; letter-spacing:.14em; text-transform:uppercase;
        border:1px solid rgba(148,163,184,.20);
        cursor:pointer;
        background:rgba(15,23,42,.55);
        color:#e5e7eb;
      }
      .btn-mini:hover{
        border-color: rgba(165,180,252,.7);
        box-shadow: 0 0 10px rgba(129,140,248,.25);
      }

      /* Center preview modal (hover-friendly) */
      .loot-modal{
        position:fixed; inset:0;
        display:none;
        align-items:center; justify-content:center;
        z-index:70;
        background:rgba(0,0,0,.55);
        backdrop-filter:blur(10px);
      }
      .loot-modal.on{ display:flex; }

      .loot-modal-card{
        width:min(420px, 92vw);
        border-radius:24px;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(2,6,23,.86);
        box-shadow:0 0 34px rgba(0,0,0,.5);
        padding:14px;
        position:relative;
        animation:popIn 140ms ease-out;
      }
      @keyframes popIn{ from{ transform:scale(.98); opacity:0; } to{ transform:scale(1); opacity:1; } }

      .loot-modal-img{
        width:100%;
        aspect-ratio:3/4;
        border-radius:18px;
        overflow:hidden;
        border:1px solid rgba(148,163,184,.22);
        background:rgba(15,23,42,.45);
      }
      .loot-modal-img img{ width:100%; height:100%; object-fit:cover; display:block; }

      .loot-modal-meta{
        display:flex; justify-content:space-between; gap:10px;
        margin-top:10px; align-items:center;
      }
      .loot-modal-name{
        font-size:12px; letter-spacing:.12em; text-transform:uppercase;
        color:#e5e7eb; font-weight:800;
      }
      .loot-modal-tag{
        font-size:11px; letter-spacing:.14em; text-transform:uppercase;
        padding:6px 10px; border-radius:999px;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(15,23,42,.55);
      }
      .loot-modal-close{
        position:absolute; right:10px; top:10px;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(15,23,42,.55);
        color:#e5e7eb;
        border-radius:999px;
        padding:8px 10px;
        cursor:pointer;
        font-size:12px;
      }
      .loot-modal-close:hover{
        border-color: rgba(165,180,252,.7);
        box-shadow: 0 0 10px rgba(129,140,248,.25);
      }

      /* small link glow */
      .collection-link{ font-size:12px; color:#a5b4fc; cursor:pointer; text-decoration:underline; width:fit-content; }
      .collection-link:hover{ color:#c4b5fd; }

      /* ==========================
         ‚úÖ V10 Roulette CS:GO
         ========================== */
      .case-overlay{
        position:fixed; inset:0;
        display:none;
        align-items:center; justify-content:center;
        z-index:120;
        background:rgba(0,0,0,.62);
        backdrop-filter: blur(12px);
        padding:18px;
      }
      .case-overlay.on{ display:flex; }

      .case-modal{
        width:min(980px, 96vw);
        border-radius:26px;
        border:1px solid rgba(148,163,184,.22);
        background:rgba(2,6,23,.88);
        box-shadow:0 0 44px rgba(0,0,0,.55);
        padding:18px;
        position:relative;
      }

      .case-top{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:10px;
        margin-bottom:12px;
      }
      .case-title{
        font-size:12px;
        letter-spacing:.22em;
        text-transform:uppercase;
        color:#cbd5e1;
        font-weight:800;
      }
      .case-sub{
        font-size:12px;
        color:#9ca3af;
      }

      .case-viewport{
        position:relative;
        border-radius:22px;
        border:1px solid rgba(148,163,184,.20);
        background:radial-gradient(circle at top,#0b1120,#020617 70%);
        overflow:hidden;
        padding:18px 12px;
      }

      .case-strip{
        position:relative;
        height:160px;
        display:flex;
        align-items:center;
      }

      .case-reel{
        display:flex;
        align-items:center;
        gap:12px;
        will-change: transform;
        transform: translateX(0px);
      }
      .case-reel.spinning{
        transition: transform 4.9s cubic-bezier(0.08, 0.82, 0.12, 1);
      }

      .case-cursor{
        position:absolute;
        left:50%;
        top:0;
        transform:translateX(-50%);
        width:3px;
        height:100%;
        background: linear-gradient(to bottom, transparent, rgba(250,204,21,.95), transparent);
        box-shadow: 0 0 18px rgba(250,204,21,.55);
        border-radius:999px;
        pointer-events:none;
      }

      .case-fade-left,
      .case-fade-right{
        position:absolute;
        top:0; bottom:0;
        width:120px;
        pointer-events:none;
        z-index:2;
      }
      .case-fade-left{
        left:0;
        background: linear-gradient(to right, rgba(2,6,23,.92), rgba(2,6,23,0));
      }
      .case-fade-right{
        right:0;
        background: linear-gradient(to left, rgba(2,6,23,.92), rgba(2,6,23,0));
      }

      .case-item{
        width:132px;
        height:156px;
        border-radius:18px;
        border:1px solid rgba(148,163,184,.16);
        background:rgba(15,23,42,.32);
        overflow:hidden;
        display:flex;
        flex-direction:column;
        justify-content:space-between;
        flex:0 0 auto;
        box-shadow: 0 0 0 rgba(0,0,0,0);
        transform: translateY(0px);
      }
      .case-thumb{
        width:100%;
        height:112px;
        overflow:hidden;
        border-bottom:1px solid rgba(148,163,184,.12);
        background:#020617;
      }
      .case-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

      .case-meta{
        padding:8px 10px 10px;
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:8px;
        min-width:0;
      }
      .case-name{
        font-size:10px;
        letter-spacing:.12em;
        text-transform:uppercase;
        font-weight:900;
        color:#e5e7eb;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
      }
      .case-rarity{
        font-size:10px;
        letter-spacing:.12em;
        text-transform:uppercase;
        padding:4px 8px;
        border-radius:999px;
        border:1px solid rgba(148,163,184,.16);
        background:rgba(2,6,23,.35);
        flex:0 0 auto;
        font-weight:900;
      }
      .case-rarity.common{ color:#facc15; }
      .case-rarity.rare{ color:#38bdf8; }
      .case-rarity.ultra{ color:#a855f7; }
      .case-rarity.legendary{ color:#f97316; }

      .case-item.won{
        border-color: rgba(250,204,21,.55);
        box-shadow: 0 0 22px rgba(250,204,21,.22);
        transform: translateY(-3px);
        animation: wonPulse 650ms ease-in-out infinite alternate;
      }
      @keyframes wonPulse{
        from{ box-shadow: 0 0 14px rgba(250,204,21,.22); }
        to{ box-shadow: 0 0 28px rgba(250,204,21,.38); }
      }

      .case-actions{
        margin-top:12px;
        display:flex;
        justify-content:flex-end;
        gap:10px;
      }
      .case-btn{
        border-radius:999px;
        padding:10px 14px;
        font-size:11px;
        letter-spacing:.14em;
        text-transform:uppercase;
        border:1px solid rgba(148,163,184,.20);
        background:rgba(15,23,42,.55);
        color:#e5e7eb;
        cursor:pointer;
      }
      .case-btn:disabled{ opacity:.45; cursor:default; }
      .case-btn.primary{
        border:none;
        background: radial-gradient(circle at top left, #a855f7, #4f46e5);
        box-shadow: 0 0 18px rgba(168,85,247,.30);
      }
    </style>
  </head>

  <body>
    <!-- Center preview modal -->
    <div class="loot-modal" id="loot-modal" aria-hidden="true">
      <div class="loot-modal-card" role="dialog" aria-modal="true">
        <button class="loot-modal-close" id="loot-modal-close">‚úï</button>
        <div class="loot-modal-img">
          <img id="loot-modal-img" src="" alt="Preview" />
        </div>
        <div class="loot-modal-meta">
          <div class="loot-modal-name" id="loot-modal-name">‚Äî</div>
          <div class="loot-modal-tag" id="loot-modal-tag">‚Äî</div>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Roulette overlay -->
    <div class="case-overlay" id="case-overlay" aria-hidden="true">
      <div class="case-modal" role="dialog" aria-modal="true">
        <div class="case-top">
          <div>
            <div class="case-title">VAULTSPIN ¬∑ OPENING</div>
            <div class="case-sub" id="case-sub">La roulette ralentit et s‚Äôarr√™te sur ta carte.</div>
          </div>
          <button class="case-btn" id="case-close" disabled>Close</button>
        </div>

        <div class="case-viewport" id="case-viewport">
          <div class="case-fade-left"></div>
          <div class="case-fade-right"></div>

          <div class="case-strip">
            <div class="case-cursor"></div>
            <div class="case-reel" id="case-reel"></div>
          </div>
        </div>

        <div class="case-actions">
          <button class="case-btn primary" id="case-continue" disabled>Continue</button>
        </div>
      </div>
    </div>

    <!-- Top bar -->
    <div class="top-bar">
      <div class="top-left">
        <div class="top-logo">VAULTSPIN ¬∑ PACKS HYBRIDES</div>
      </div>
      <div class="top-right">
        <a class="top-link" href="collection.html" id="collection-toplink">Ma collection</a>

        <div class="wallet-wrap">
          <div class="wallet-pill" title="Mode d√©mo : ouvertures infinies">
            <span class="wallet-label">Mon wallet</span>
            <span class="wallet-main" id="wallet-eur">‚àû ‚Ç¨</span>
            <span class="wallet-sub" id="wallet-eth">‚âà ‚àû ETH</span>
          </div>

          <div class="wallet-pop">
            <h3>Wallet (d√©mo)</h3>
            <div class="wallet-hint">
              Mode ‚Äúouvertures infinies‚Äù activ√©.<br/>
              On garde <b>Spent</b> en stats pour le feeling.
            </div>
            <div style="margin-top:10px; display:flex; gap:10px;">
              <button class="btn-mini" id="reset-data">Reset data</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="page">
      <!-- LEFT -->
      <div class="left-panel">
        <div class="tag">VAULTSPIN ¬∑ D√âMO (OFF-CHAIN)</div>

        <div>
          <h1>Open your VaultSpin Pack</h1>
          <p class="subtitle">
            V10 : roulette type CS:GO (reel 60 items au poids + stop sur la carte gagnante).
          </p>
        </div>

        <div class="btn-row">
          <button id="open-pack-btn" class="btn-primary">Open VaultSpin Pack ‚Äî 3,99 ‚Ç¨</button>
        </div>

        <div id="status-line" class="status-line">
          <span class="status-dot" id="status-dot"></span>
          <span id="status-text">Mode d√©mo : ouvre des packs sans wallet.</span>
        </div>
        <p class="caption">
          Dans la version finale, le prix sera d√©bit√© de ton wallet VaultSpin (CB ou crypto convertie en ‚Ç¨).
        </p>

        <!-- Stats -->
        <div class="stats">
          <div class="stat">
            <div class="k">Packs opened</div>
            <div class="v" id="stat-opened">0</div>
            <div class="s">Total</div>
          </div>

          <div class="stat">
            <div class="k">Spent</div>
            <div class="v" id="stat-spent">0‚Ç¨</div>
            <div class="s">Local</div>
          </div>

          <div class="stat">
            <div class="k">Last pull</div>
            <div class="v" id="stat-last">‚Äî</div>
            <div class="s" id="stat-last-sub">‚Äî</div>
          </div>

          <div class="stat">
            <div class="k">Best pull</div>
            <div class="best-pull">
              <div class="best-thumb"><img id="stat-best-img" src="images/venusaur_common.png" alt="Best" /></div>
              <div class="best-meta">
                <div class="line1" id="stat-best-line1">‚Äî</div>
                <div class="line2" id="stat-best-line2">‚Äî</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Timeline -->
        <div class="history">
          <div class="history-title">
            <span>Pack history</span>
            <button class="history-clear" id="clear-history">Clear</button>
          </div>
          <div class="history-list" id="history-list"></div>
        </div>

        <div style="margin-top: 6px">
          <div class="caption" id="mint-info">
            En attente d‚Äôune ouverture‚Ä¶ clique sur le bouton pour voir la carte ici.
          </div>
          <a class="collection-link" href="collection.html" id="collection-link">‚Üí Voir ma collection</a>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="right-panel">
        <div class="card-zone">
          <div class="fx-overlay" id="fx-overlay"></div>

          <div id="card-frame" class="card-frame state-closed" data-rarity="COMMON">
            <div class="card-inner">
              <div id="booster-closed" class="booster-closed booster-mode-idle">
                <div class="booster-label">
                  <div class="booster-leaf-icon">üåø</div>
                  <div class="booster-chip">VaultSpin Pack</div>
                  <div class="booster-title">Booster Plante</div>
                  <div class="booster-subtitle">1 carte √† r√©v√©ler</div>
                </div>
              </div>

              <div id="card-opened" class="card-opened hidden">
                <div class="imgwrap" id="imgwrap">
                  <img id="card-image" src="images/venusaur_common.png" alt="VaultSpin Card" />
                  <div class="mystery-cover" id="mystery-cover">
                    <div class="mystery-shimmer"></div>
                  </div>
                </div>

                <div class="card-footer">
                  <div class="card-footer-left">
                    <div>VAULTSPIN (D√âMO)</div>
                    <div class="token-id" id="token-id-label">#‚Äì</div>
                  </div>
                  <div class="card-footer-right rarity-common" id="rarity-label">Common</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Drops -->
        <div class="drop-table">
          <div class="drop-title">Cartes potentiellement obtenables (hover = preview ¬∑ click = filtre collection)</div>

          <div class="drop-grid" id="drop-grid">
            <!-- COMMON -->
            <div class="drop-item" data-rarity="COMMON" data-name="Bulbizarre" data-img="images/bulbasaur_common.png" data-ct="0">
              <div class="drop-thumb"><img src="images/bulbasaur_common.png" alt="Bulbizarre Common" /></div>
              <div class="drop-name">Bulbizarre</div>
              <div class="drop-meta"><span>70% de chance</span><span class="drop-tag common">Common</span></div>
            </div>

            <div class="drop-item" data-rarity="COMMON" data-name="Herbizarre" data-img="images/ivysaur_common.png" data-ct="1">
              <div class="drop-thumb"><img src="images/ivysaur_common.png" alt="Herbizarre Common" /></div>
              <div class="drop-name">Herbizarre</div>
              <div class="drop-meta"><span>70% de chance</span><span class="drop-tag common">Common</span></div>
            </div>

            <div class="drop-item" data-rarity="COMMON" data-name="Florizarre" data-img="images/venusaur_common.png" data-ct="2">
              <div class="drop-thumb"><img src="images/venusaur_common.png" alt="Florizarre Common" /></div>
              <div class="drop-name">Florizarre</div>
              <div class="drop-meta"><span>70% de chance</span><span class="drop-tag common">Common</span></div>
            </div>

            <!-- RARE -->
            <div class="drop-item" data-rarity="RARE" data-name="Bulbizarre" data-img="images/bulbasaur_rare.png" data-ct="3">
              <div class="drop-thumb"><img src="images/bulbasaur_rare.png" alt="Bulbizarre Rare" /></div>
              <div class="drop-name">Bulbizarre</div>
              <div class="drop-meta"><span>20% de chance</span><span class="drop-tag rare">Rare</span></div>
            </div>

            <div class="drop-item" data-rarity="RARE" data-name="Herbizarre" data-img="images/ivysaur_rare.png" data-ct="4">
              <div class="drop-thumb"><img src="images/ivysaur_rare.png" alt="Herbizarre Rare" /></div>
              <div class="drop-name">Herbizarre</div>
              <div class="drop-meta"><span>20% de chance</span><span class="drop-tag rare">Rare</span></div>
            </div>

            <div class="drop-item" data-rarity="RARE" data-name="Florizarre" data-img="images/venusaur_rare.png" data-ct="5">
              <div class="drop-thumb"><img src="images/venusaur_rare.png" alt="Florizarre Rare" /></div>
              <div class="drop-name">Florizarre</div>
              <div class="drop-meta"><span>20% de chance</span><span class="drop-tag rare">Rare</span></div>
            </div>

            <!-- ULTRA -->
            <div class="drop-item" data-rarity="ULTRA" data-name="Bulbizarre" data-img="images/bulbasaur_ultra.png" data-ct="6">
              <div class="drop-thumb"><img src="images/bulbasaur_ultra.png" alt="Bulbizarre Ultra" /></div>
              <div class="drop-name">Bulbizarre</div>
              <div class="drop-meta"><span>9% de chance</span><span class="drop-tag ultra">Ultra</span></div>
            </div>

            <div class="drop-item" data-rarity="ULTRA" data-name="Herbizarre" data-img="images/ivysaur_ultra.png" data-ct="7">
              <div class="drop-thumb"><img src="images/ivysaur_ultra.png" alt="Herbizarre Ultra" /></div>
              <div class="drop-name">Herbizarre</div>
              <div class="drop-meta"><span>9% de chance</span><span class="drop-tag ultra">Ultra</span></div>
            </div>

            <div class="drop-item" data-rarity="ULTRA" data-name="Florizarre" data-img="images/venusaur_ultra.png" data-ct="8">
              <div class="drop-thumb"><img src="images/venusaur_ultra.png" alt="Florizarre Ultra" /></div>
              <div class="drop-name">Florizarre</div>
              <div class="drop-meta"><span>9% de chance</span><span class="drop-tag ultra">Ultra</span></div>
            </div>

            <!-- LEGENDARY -->
            <div class="drop-item" data-rarity="LEGENDARY" data-name="Bulbizarre" data-img="images/bulbasaur_legendary.png" data-ct="9">
              <div class="drop-thumb"><img src="images/bulbasaur_legendary.png" alt="Bulbizarre Legendary" /></div>
              <div class="drop-name">Bulbizarre</div>
              <div class="drop-meta"><span>1% de chance</span><span class="drop-tag legendary">Legendary</span></div>
            </div>

            <div class="drop-item" data-rarity="LEGENDARY" data-name="Herbizarre" data-img="images/ivysaur_legendary.png" data-ct="10">
              <div class="drop-thumb"><img src="images/ivysaur_legendary.png" alt="Herbizarre Legendary" /></div>
              <div class="drop-name">Herbizarre</div>
              <div class="drop-meta"><span>1% de chance</span><span class="drop-tag legendary">Legendary</span></div>
            </div>

            <div class="drop-item" data-rarity="LEGENDARY" data-name="Florizarre" data-img="images/venusaur_legendary.png" data-ct="11">
              <div class="drop-thumb"><img src="images/venusaur_legendary.png" alt="Florizarre Legendary" /></div>
              <div class="drop-name">Florizarre</div>
              <div class="drop-meta"><span>1% de chance</span><span class="drop-tag legendary">Legendary</span></div>
            </div>

            <div class="drop-item" data-rarity="LEGENDARY" data-name="Plante" data-img="images/plant_legendary.png" data-ct="12">
              <div class="drop-thumb"><img src="images/plant_legendary.png" alt="Plante Legendary" /></div>
              <div class="drop-name">Plante</div>
              <div class="drop-meta"><span>1% de chance</span><span class="drop-tag legendary">Legendary</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sounds -->
    <audio id="sfx-booster" src="sounds/booster_open.mp3" preload="auto"></audio>
    <audio id="sfx-reveal" src="sounds/card_reveal.mp3" preload="auto"></audio>
    <audio id="sfx-legendary" src="sounds/legendary_fx.mp3" preload="auto"></audio>

    <script>
      /********************
       * STORAGE KEYS
       ********************/
      const VS_COLLECTION_KEY = "vaultspin_collection_v1";
      const VS_TOKEN_COUNTER_KEY = "vaultspin_demo_token_counter_v1";

      /********************
       * ECONOMY (‚àû wallet)
       ********************/
      const PACK_PRICE_EUR = 3.99;

      /********************
       * Cards config
       ********************/
      const CARD_IMAGE_BY_INDEX = {
        0:"images/bulbasaur_common.png",
        1:"images/ivysaur_common.png",
        2:"images/venusaur_common.png",
        3:"images/bulbasaur_rare.png",
        4:"images/ivysaur_rare.png",
        5:"images/venusaur_rare.png",
        6:"images/bulbasaur_ultra.png",
        7:"images/ivysaur_ultra.png",
        8:"images/venusaur_ultra.png",
        9:"images/bulbasaur_legendary.png",
        10:"images/ivysaur_legendary.png",
        11:"images/venusaur_legendary.png",
        12:"images/plant_legendary.png",
      };

      const CARD_NAME_BY_INDEX = {
        0:"Bulbizarre",
        1:"Herbizarre",
        2:"Florizarre",
        3:"Bulbizarre",
        4:"Herbizarre",
        5:"Florizarre",
        6:"Bulbizarre",
        7:"Herbizarre",
        8:"Florizarre",
        9:"Bulbizarre",
        10:"Herbizarre",
        11:"Florizarre",
        12:"Plante",
      };

      const CARD_RARITY_BY_INDEX = { 0:0,1:0,2:0, 3:1,4:1,5:1, 6:2,7:2,8:2, 9:3,10:3,11:3,12:3 };
      const CARD_WEIGHT_BY_INDEX = { 0:7000,1:7000,2:7000, 3:2000,4:2000,5:2000, 6:900,7:900,8:900, 9:100,10:100,11:100,12:100 };

      const RARITY_LABEL_CLASS = { COMMON:"rarity-common", RARE:"rarity-rare", ULTRA:"rarity-ultra", LEGENDARY:"rarity-legendary" };
      const RARITY_ORDER = ["COMMON","RARE","ULTRA","LEGENDARY"];

      function rarityToLabel(num){ return ({0:"Common",1:"Rare",2:"Ultra",3:"Legendary"})[num] || "Common"; }
      function rarityKeyFromNum(num){ return (num===0)?"COMMON":(num===1)?"RARE":(num===2)?"ULTRA":(num===3)?"LEGENDARY":"COMMON"; }
      function rarityClassFromKey(k){
        if (k==="LEGENDARY") return "legendary";
        if (k==="ULTRA") return "ultra";
        if (k==="RARE") return "rare";
        return "common";
      }

      function pickWeightedCardIndex(){
        let total = 0;
        for (const k in CARD_WEIGHT_BY_INDEX) total += CARD_WEIGHT_BY_INDEX[k];
        const roll = Math.floor(Math.random() * total);
        let c = 0;
        for (const k in CARD_WEIGHT_BY_INDEX){
          c += CARD_WEIGHT_BY_INDEX[k];
          if (roll < c) return parseInt(k, 10);
        }
        return 0;
      }

      /********************
       * Collection helpers
       ********************/
      function getCollection(){
        try{ return JSON.parse(localStorage.getItem(VS_COLLECTION_KEY) || "[]"); }
        catch{ return []; }
      }
      function setCollection(arr){ localStorage.setItem(VS_COLLECTION_KEY, JSON.stringify(arr)); }

      function nextLocalTokenId(){
        const raw = localStorage.getItem(VS_TOKEN_COUNTER_KEY);
        const n = raw ? Number(raw) : 1;
        const next = Number.isFinite(n) && n > 0 ? n : 1;
        localStorage.setItem(VS_TOKEN_COUNTER_KEY, String(next + 1));
        return next;
      }

      function pushToCollection(entry){
        const arr = getCollection();
        arr.unshift(entry);
        setCollection(arr);
      }

      /********************
       * UI state
       ********************/
      const UI_STATE = { IDLE:"idle", OPENING:"opening", MYSTERY:"mystery", REVEAL:"reveal", ADDING:"adding", ROULETTE:"roulette" };
      let uiState = UI_STATE.IDLE;

      let sfxBooster=null, sfxReveal=null, sfxLegendary=null;

      function sleep(ms){ return new Promise((r)=>setTimeout(r, ms)); }
      function isBusy(){ return uiState !== UI_STATE.IDLE; }

      function setStatus(text, mode="ok"){
        const t = document.getElementById("status-text");
        const d = document.getElementById("status-dot");
        t.textContent = text;
        d.classList.remove("error","pending");
        if (mode==="error") d.classList.add("error");
        if (mode==="pending") d.classList.add("pending");
      }

      function playSound(el){
        if(!el) return;
        try{ el.currentTime=0; el.play().catch(()=>{}); }catch(_){}
      }

      function setBoosterMode(modeClass){
        const booster = document.getElementById("booster-closed");
        booster.classList.remove("booster-mode-idle","booster-mode-opening","booster-mode-split","booster-mode-hidden");
        if(modeClass) booster.classList.add(modeClass);
      }

      function showOpenedCardLayout(){
        const booster = document.getElementById("booster-closed");
        const opened = document.getElementById("card-opened");
        const frame = document.getElementById("card-frame");
        booster.classList.add("hidden");
        setBoosterMode("booster-mode-hidden");
        opened.classList.remove("hidden");
        frame.classList.remove("state-closed");
        frame.classList.add("state-opened");
      }

      function resetToBoosterClosed(){
        const booster = document.getElementById("booster-closed");
        const opened = document.getElementById("card-opened");
        const frame = document.getElementById("card-frame");
        const cover = document.getElementById("mystery-cover");
        const imgwrap = document.getElementById("imgwrap");

        opened.classList.add("hidden");
        opened.classList.remove("transfer-to-collection");
        cover.classList.remove("on");
        imgwrap.classList.remove("flip");

        booster.classList.remove("hidden");
        setBoosterMode("booster-mode-idle");

        frame.classList.remove("state-opened","opening");
        frame.classList.add("state-closed");
        frame.setAttribute("data-rarity","COMMON");
      }

      function triggerFX(rarityKey){
        const fx = document.getElementById("fx-overlay");
        fx.className = "fx-overlay on " + (
          rarityKey==="LEGENDARY" ? "legendary" :
          rarityKey==="ULTRA" ? "ultra" :
          rarityKey==="RARE" ? "rare" : "common"
        );
        setTimeout(()=> fx.className="fx-overlay", 800);
      }

      function formatDate(ts){
        const d = new Date(ts);
        return d.toLocaleString("fr-FR", { day:"2-digit", month:"2-digit", year:"2-digit", hour:"2-digit", minute:"2-digit" });
      }

      function bestPullFromCollection(arr){
        if (!arr.length) return null;
        let best = arr[0];
        for (const c of arr){
          if (RARITY_ORDER.indexOf(c.rarityKey) > RARITY_ORDER.indexOf(best.rarityKey)) best = c;
        }
        return best;
      }

      function renderStats(){
        const arr = getCollection();
        const opened = arr.length;
        const spent = opened * PACK_PRICE_EUR;
        const last = opened ? arr[0] : null;
        const best = opened ? bestPullFromCollection(arr) : null;

        document.getElementById("stat-opened").textContent = String(opened);
        document.getElementById("stat-spent").textContent = spent.toLocaleString("fr-FR", { maximumFractionDigits: 2 }) + "‚Ç¨";

        if (last){
          document.getElementById("stat-last").textContent = "#" + last.tokenId;
          document.getElementById("stat-last-sub").textContent = last.rarityLabel;
        } else {
          document.getElementById("stat-last").textContent = "‚Äî";
          document.getElementById("stat-last-sub").textContent = "‚Äî";
        }

        if (best){
          document.getElementById("stat-best-img").src = best.img;
          document.getElementById("stat-best-line1").textContent = best.rarityLabel + " #" + best.tokenId;
          document.getElementById("stat-best-line2").textContent = formatDate(best.ts);
        } else {
          document.getElementById("stat-best-line1").textContent = "‚Äî";
          document.getElementById("stat-best-line2").textContent = "‚Äî";
        }
      }

      function dotClassForRarityKey(k){
        if (k==="LEGENDARY") return "legendary";
        if (k==="ULTRA") return "ultra";
        if (k==="RARE") return "rare";
        return "common";
      }

      function renderHistory(){
        const list = document.getElementById("history-list");
        const arr = getCollection().slice(0, 12);

        list.innerHTML = "";
        if (!arr.length){
          const empty = document.createElement("div");
          empty.className = "caption";
          empty.textContent = "Aucun pack ouvert pour l‚Äôinstant.";
          list.appendChild(empty);
          return;
        }

        for (const c of arr){
          const row = document.createElement("div");
          row.className = "hist-item";
          row.setAttribute("data-img", c.img);
          row.setAttribute("data-name", c.name || "Card");
          row.setAttribute("data-rarity", c.rarityKey);

          const dot = document.createElement("div");
          dot.className = "hist-dot " + dotClassForRarityKey(c.rarityKey);

          const main = document.createElement("div");
          main.className = "hist-main";

          const l1 = document.createElement("div");
          l1.className = "hist-line1";
          l1.innerHTML = `<span>#${c.tokenId}</span><span class="pill-mini">${c.rarityLabel}</span>`;

          const l2 = document.createElement("div");
          l2.className = "hist-line2";
          l2.textContent = formatDate(c.ts);

          main.appendChild(l1);
          main.appendChild(l2);

          const tools = document.createElement("div");
          tools.className = "hist-tools";

          const previewBtn = document.createElement("button");
          previewBtn.className = "hist-open";
          previewBtn.textContent = "Preview";
          previewBtn.addEventListener("click", (e) => {
            e.preventDefault();
            openLootModal({ img: c.img, name: c.name || "VaultSpin", rarity: c.rarityKey });
          });

          tools.appendChild(previewBtn);

          row.appendChild(dot);
          row.appendChild(main);
          row.appendChild(tools);

          row.addEventListener("mouseenter", () => openLootModal({ img: c.img, name: c.name || "VaultSpin", rarity: c.rarityKey }));
          row.addEventListener("mouseleave", closeLootModal);

          list.appendChild(row);
        }
      }

      function setCardFooter(tokenId, rarityNum, rarityKey){
        const frame = document.getElementById("card-frame");
        const tokenIdLabel = document.getElementById("token-id-label");
        const rarityLabel = document.getElementById("rarity-label");

        tokenIdLabel.textContent = "#" + tokenId;

        frame.setAttribute("data-rarity", rarityKey);

        rarityLabel.textContent = rarityToLabel(rarityNum);
        rarityLabel.className = "card-footer-right";
        const cls = RARITY_LABEL_CLASS[rarityKey];
        if (cls) rarityLabel.classList.add(cls);
      }

      async function animateToCollection(){
        uiState = UI_STATE.ADDING;
        setStatus("Ajout √† la collection‚Ä¶", "pending");

        const opened = document.getElementById("card-opened");
        opened.classList.add("transfer-to-collection");

        await sleep(850);
        resetToBoosterClosed();
      }

      async function mysteryThenReveal(imgSrc){
        uiState = UI_STATE.MYSTERY;

        showOpenedCardLayout();

        const img = document.getElementById("card-image");
        const cover = document.getElementById("mystery-cover");
        const imgwrap = document.getElementById("imgwrap");

        img.style.opacity = "0";
        cover.classList.add("on");
        setStatus("Suspense‚Ä¶", "pending");
        await sleep(520);

        uiState = UI_STATE.REVEAL;
        imgwrap.classList.add("flip");
        await sleep(220);

        img.src = imgSrc;
        img.style.opacity = "1";

        cover.classList.remove("on");
        await sleep(160);

        imgwrap.classList.remove("flip");
      }

      /********************
       * ‚úÖ V10 Roulette
       ********************/
      function openCaseOverlay(){
        const overlay = document.getElementById("case-overlay");
        overlay.classList.add("on");
        overlay.setAttribute("aria-hidden", "false");
      }
      function closeCaseOverlay(){
        const overlay = document.getElementById("case-overlay");
        overlay.classList.remove("on");
        overlay.setAttribute("aria-hidden", "true");
      }

      function renderReelItems(reelItems){
        const reel = document.getElementById("case-reel");
        reel.innerHTML = "";
        for (let i=0;i<reelItems.length;i++){
          const ct = reelItems[i];
          const rarityNum = CARD_RARITY_BY_INDEX[ct] ?? 0;
          const rk = rarityKeyFromNum(rarityNum);

          const el = document.createElement("div");
          el.className = "case-item";
          el.setAttribute("data-i", String(i));
          el.setAttribute("data-ct", String(ct));

          el.innerHTML = `
            <div class="case-thumb"><img src="${CARD_IMAGE_BY_INDEX[ct]}" alt="${CARD_NAME_BY_INDEX[ct] || ("Card #"+ct)}"/></div>
            <div class="case-meta">
              <div class="case-name">${escapeHtml(CARD_NAME_BY_INDEX[ct] || ("Card #"+ct))}</div>
              <div class="case-rarity ${rarityClassFromKey(rk)}">${rk}</div>
            </div>
          `;
          reel.appendChild(el);
        }
      }

      function escapeHtml(s){
        return String(s || "").replace(/[&<>"']/g, (c) => ({
          "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#039;"
        }[c]));
      }

      function getReelStepPx(){
        const reel = document.getElementById("case-reel");
        const first = reel.firstElementChild;
        if (!first) return 144; // fallback
        const w = first.getBoundingClientRect().width;
        const gapStr = (getComputedStyle(reel).gap || "12px");
        const gap = parseFloat(gapStr) || 12;
        return w + gap;
      }

      function buildReelWeighted(totalItems, winningCt){
        // 1) Fill weighted
        const arr = [];
        for (let i=0;i<totalItems;i++){
          arr.push(pickWeightedCardIndex());
        }

        // 2) Force winning at a late stopIndex
        const stopIndex = Math.max(20, totalItems - 12);
        arr[stopIndex] = winningCt;

        return { reelItems: arr, stopIndex };
      }

      async function spinReelToStop(stopIndex){
        const viewport = document.getElementById("case-viewport");
        const reel = document.getElementById("case-reel");

        // Reset transition clean
        reel.classList.remove("spinning");
        reel.style.transform = "translateX(0px)";

        await sleep(40);

        const step = getReelStepPx();
        const viewportW = viewport.getBoundingClientRect().width;

        // Center of stop item relative to reel start
        const targetCenter = stopIndex * step + (step / 2);
        const cursorX = viewportW / 2;

        // Translate so that item center lands on cursor
        const targetTranslate = targetCenter - cursorX;

        // Add some "human" tiny jitter but keep within item center tolerance
        const jitter = (Math.random() * 6) - 3; // -3..+3 px
        const finalX = -(targetTranslate + jitter);

        // Force reflow then animate
        void reel.offsetHeight;
        reel.classList.add("spinning");

        // Start booster split in background for coherence
        setBoosterMode("booster-mode-split");
        playSound(sfxBooster);

        requestAnimationFrame(() => {
          reel.style.transform = `translateX(${finalX}px)`;
        });

        return new Promise((resolve) => {
          const onEnd = () => {
            reel.removeEventListener("transitionend", onEnd);
            resolve();
          };
          reel.addEventListener("transitionend", onEnd, { once:true });
        });
      }

      function markWinningItem(stopIndex){
        const reel = document.getElementById("case-reel");
        const kids = reel.querySelectorAll(".case-item");
        kids.forEach(k => k.classList.remove("won"));
        const el = reel.querySelector(`.case-item[data-i="${stopIndex}"]`);
        if (el) el.classList.add("won");
      }

      async function openPackV10_Roulette(){
        if (isBusy()) return;
        uiState = UI_STATE.ROULETTE;

        const btn = document.getElementById("open-pack-btn");
        btn.disabled = true;

        // disable overlay buttons until done
        const closeBtn = document.getElementById("case-close");
        const contBtn = document.getElementById("case-continue");
        closeBtn.disabled = true;
        contBtn.disabled = true;

        setStatus("Ouverture : lancement de la roulette‚Ä¶", "pending");

        // ‚úÖ 1) Decide winner FIRST (truth)
        const winningCt = pickWeightedCardIndex();
        const rarityNum = CARD_RARITY_BY_INDEX[winningCt] ?? 0;
        const rarityKey = rarityKeyFromNum(rarityNum);
        const imgSrc = CARD_IMAGE_BY_INDEX[winningCt] ?? CARD_IMAGE_BY_INDEX[0];

        // ‚úÖ 2) Build reel (60 items, weighted), force winner near end
        const { reelItems, stopIndex } = buildReelWeighted(60, winningCt);

        // ‚úÖ 3) Open overlay + render reel
        openCaseOverlay();
        renderReelItems(reelItems);

        // small delay for layout
        await sleep(60);

        // ‚úÖ 4) Spin & decelerate to stopIndex
        await spinReelToStop(stopIndex);

        // ‚úÖ 5) Highlight winner
        markWinningItem(stopIndex);

        // enable buttons
        document.getElementById("case-sub").textContent = `‚úÖ Tu as obtenu : ${CARD_NAME_BY_INDEX[winningCt] || ("Card #"+winningCt)} ¬∑ ${rarityToLabel(rarityNum)}`;
        contBtn.disabled = false;
        closeBtn.disabled = false;

        // ‚úÖ 6) Commit mint/collection AFTER spin ends (same as before)
        const tokenId = nextLocalTokenId();

        // reveal in right card zone (cin√©)
        await mysteryThenReveal(imgSrc);
        setCardFooter(tokenId, rarityNum, rarityKey);

        playSound(sfxReveal);
        if (rarityKey === "LEGENDARY") playSound(sfxLegendary);
        triggerFX(rarityKey);

        const entry = {
          tokenId,
          ts: Date.now(),
          priceEur: PACK_PRICE_EUR,
          rarity: rarityNum,
          rarityLabel: rarityToLabel(rarityNum),
          rarityKey,
          cardTypeIndex: winningCt,
          img: imgSrc,
          name: CARD_NAME_BY_INDEX[winningCt] || ("Card #" + winningCt)
        };

        pushToCollection(entry);

        document.getElementById("mint-info").textContent =
          `Carte ajout√©e √† ta collection ‚Äî tokenId ${tokenId} ‚Ä¢ ${entry.rarityLabel} ‚Ä¢ cardTypeIndex ${winningCt}`;

        renderStats();
        renderHistory();

        // auto fly to collection after a bit (keeps your current vibe)
        await sleep(320);
        await animateToCollection();

        uiState = UI_STATE.IDLE;
        btn.disabled = false;
        setStatus("Pack ouvert ‚úÖ Carte ajout√©e √† ta collection.", "ok");
      }

      /********************
       * Modal preview (loot list)
       ********************/
      function openLootModal({ img, name, rarity }){
        const modal = document.getElementById("loot-modal");
        document.getElementById("loot-modal-img").src = img;
        document.getElementById("loot-modal-name").textContent = name || "‚Äî";
        document.getElementById("loot-modal-tag").textContent = rarity || "‚Äî";
        modal.classList.add("on");
        modal.setAttribute("aria-hidden", "false");
      }
      function closeLootModal(){
        const modal = document.getElementById("loot-modal");
        modal.classList.remove("on");
        modal.setAttribute("aria-hidden", "true");
      }

      /********************
       * Filtered collection navigation
       ********************/
      function openCollectionFiltered(cardTypeIndex){
        window.location.href = "collection.html?ct=" + encodeURIComponent(String(cardTypeIndex));
      }

      function resetAllData(){
        localStorage.removeItem(VS_COLLECTION_KEY);
        localStorage.removeItem(VS_TOKEN_COUNTER_KEY);
        setStatus("Donn√©es reset ‚úÖ", "ok");
        renderStats();
        renderHistory();
        closeLootModal();
      }

      /********************
       * Init
       ********************/
      document.addEventListener("DOMContentLoaded", () => {
        sfxBooster = document.getElementById("sfx-booster");
        sfxReveal = document.getElementById("sfx-reveal");
        sfxLegendary = document.getElementById("sfx-legendary");

        setBoosterMode("booster-mode-idle");
        renderStats();
        renderHistory();

        // ‚úÖ open pack => roulette
        document.getElementById("open-pack-btn").addEventListener("click", openPackV10_Roulette);

        // loot modal close
        document.getElementById("loot-modal-close").addEventListener("click", closeLootModal);
        document.getElementById("loot-modal").addEventListener("click", (e) => { if (e.target.id === "loot-modal") closeLootModal(); });
        document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeLootModal(); });

        // Reset data
        document.getElementById("reset-data").addEventListener("click", resetAllData);
        document.getElementById("clear-history").addEventListener("click", () => {
          localStorage.removeItem(VS_COLLECTION_KEY);
          setStatus("History cleared ‚úÖ", "ok");
          renderStats();
          renderHistory();
        });

        // Loot hover preview + click filter
        document.querySelectorAll(".drop-item").forEach((el) => {
          const img = el.getAttribute("data-img");
          const name = el.getAttribute("data-name");
          const rarity = el.getAttribute("data-rarity");
          const ct = el.getAttribute("data-ct");

          let timer = null;

          el.addEventListener("mouseenter", () => {
            timer = setTimeout(() => openLootModal({ img, name, rarity }), 110);
          });
          el.addEventListener("mouseleave", () => {
            if (timer) clearTimeout(timer);
            closeLootModal();
          });

          el.addEventListener("click", (e) => {
            e.preventDefault();
            openCollectionFiltered(ct);
          });
        });

        // ‚úÖ Overlay buttons
        document.getElementById("case-continue").addEventListener("click", () => {
          closeCaseOverlay();
        });
        document.getElementById("case-close").addEventListener("click", () => {
          closeCaseOverlay();
        });

        // ESC closes overlay (only if enabled)
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape"){
            const overlay = document.getElementById("case-overlay");
            if (overlay.classList.contains("on")){
              closeCaseOverlay();
            }
          }
        });
      });
    </script>
  </body>
</html>
