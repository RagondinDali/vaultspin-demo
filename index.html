<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>VaultSpin â€“ Pack Opening</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="animations.css" />

  <!-- âœ… Preload images visibles -->
  <link rel="preload" as="image" href="images/germignon.png">
  <link rel="preload" as="image" href="images/astronelle.png">
  <link rel="preload" as="image" href="images/majaspic.png">
  <link rel="preload" as="image" href="images/chenipan.png">
  <link rel="preload" as="image" href="images/phyllali.png">

  <link rel="preload" as="image" href="images/aquali.png">
  <link rel="preload" as="image" href="images/givrali.png">
  <link rel="preload" as="image" href="images/flobio.png">
  <link rel="preload" as="image" href="images/lokhlass.png">
  <link rel="preload" as="image" href="images/tortank.png">

  <link rel="preload" as="image" href="images/dracaufeu.png">
  <link rel="preload" as="image" href="images/dracaufeu_vmax.png">
  <link rel="preload" as="image" href="images/energie_feu.png">
  <link rel="preload" as="image" href="images/reshiram.png">
  <link rel="preload" as="image" href="images/typhlosion.png">

  <style>
    html, body { overflow-x:hidden; }
    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body{
      width:100%;
      max-width:100%;
      overflow-x:hidden;
    }

    body{
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:flex-start;
      background:radial-gradient(circle at top,#101827,#020617 60%);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:#e5e7eb;
      overflow-x:hidden;
    }

    .page{
      width:100%;
      max-width: min(1200px, calc(100vw - 32px));
      padding:96px 16px 40px;
      display:flex;
      flex-direction:column;
      gap:24px;
    }

    /* Desktop: 3 colonnes (live + left + right) */
    @media (min-width: 900px){
      .page{
        flex-direction:row;
        gap:24px;
        align-items:flex-start;
      }
      .live-panel{
        flex:0 0 280px;
        max-width:280px;
        min-width:280px;
        box-sizing:border-box;
      }
    }

    .left-panel,.right-panel{
      background:radial-gradient(circle at top left,#020617,#020617 70%);
      border-radius:28px;
      border:1px solid rgba(148,163,184,.20);
      padding:22px 22px 24px;
    }
    .left-panel{ display:flex; flex-direction:column; gap:16px; }
    .right-panel{ display:flex; flex-direction:column; gap:18px; }

    h1{ font-size:28px; font-weight:650; letter-spacing:.08em; text-transform:uppercase; color:#f9fafb; }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      border-radius:999px; border:1px solid rgba(148,163,184,.30);
      padding:5px 10px;
      font-size:10px; letter-spacing:.16em; text-transform:uppercase;
      background:radial-gradient(circle at top,#111827,#020617 70%);
    }
    .btn-row{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
    .btn-primary{
      border-radius:999px; padding:10px 18px; font-size:13px;
      letter-spacing:.14em; text-transform:uppercase;
      border:none; cursor:pointer;
      display:inline-flex; align-items:center; gap:8px; white-space:nowrap;
      background:radial-gradient(circle at top left,#a855f7,#4f46e5);
      color:#f9fafb;
      box-shadow:0 0 18px rgba(168,85,247,.45);
      transition:transform .15s ease-out, box-shadow .15s ease-out, opacity .15s ease-out;
    }
    .btn-primary:hover{ transform:translateY(-1px); box-shadow:0 0 22px rgba(168,85,247,.65); }
    .btn-primary:disabled{ opacity:.45; cursor:default; box-shadow:none; }

    .btn-free{ background:radial-gradient(circle at top left,#22c55e,#16a34a); box-shadow:0 0 18px rgba(34,197,94,.35); }
    .btn-free:hover{ box-shadow:0 0 22px rgba(34,197,94,.55); }

    .status-line{
      font-size:13px; color:#e5e7eb;
      background:rgba(15,23,42,.55);
      border-radius:999px; padding:8px 14px;
      border:1px solid rgba(148,163,184,.22);
      display:inline-flex; align-items:center; gap:8px;
    }
    .status-dot{ width:8px; height:8px; border-radius:999px; background:#22c55e; }
    .status-dot.error{ background:#f97373; }
    .status-dot.pending{ background:#facc15; }

    /* Stats */
    .stats{
      margin-top:4px;
      padding:12px;
      border-radius:20px;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(15,23,42,.35);
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
    }
    @media (max-width: 860px){
      .stats{ grid-template-columns: repeat(2, 1fr); }
    }
    .stat{
      border-radius:16px;
      border:1px solid rgba(148,163,184,.14);
      background:rgba(2,6,23,.32);
      padding:10px 10px;
      min-height:66px;
    }
    .stat .k{ font-size:10px; letter-spacing:.16em; text-transform:uppercase; color:#9ca3af; }
    .stat .v{ margin-top:5px; font-size:16px; font-weight:850; color:#f9fafb; }
    .stat .s{ margin-top:2px; font-size:11px; color:#9ca3af; }

    /* Best pull */
    .best-pull{ display:flex; align-items:center; gap:10px; margin-top:5px; }
    .best-thumb{ width:34px; height:34px; border-radius:10px; overflow:hidden; border:1px solid rgba(148,163,184,.20); background:rgba(15,23,42,.45); flex:0 0 auto; }
    .best-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .best-meta{ display:flex; flex-direction:column; gap:1px; }
    .best-meta .line1{ font-size:12px; font-weight:800; color:#f9fafb; }
    .best-meta .line2{ font-size:11px; color:#9ca3af; }

    /* History (UI only â€“ plus de localStorage ici) */
    .history{
      margin-top:6px;
      padding:12px;
      border-radius:20px;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(2,6,23,.24);
    }
    .history-title{
      font-size:10px; letter-spacing:.18em; text-transform:uppercase;
      color:#9ca3af;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:10px;
    }
    .history-clear{
      font-size:10px; letter-spacing:.14em; text-transform:uppercase;
      border-radius:999px; padding:6px 10px;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(15,23,42,.40);
      color:#e5e7eb; cursor:pointer;
    }
    .history-clear:hover{ border-color: rgba(165,180,252,.65); box-shadow: 0 0 10px rgba(129,140,248,.25); }
    .history-list{
      display:flex; flex-direction:column; gap:8px;
      max-height:200px; overflow:auto; padding-right:4px;
    }
    .hist-item{
      display:flex; align-items:center; gap:10px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.14);
      background:rgba(15,23,42,.28);
      padding:8px 10px;
    }
    .hist-dot{ width:10px; height:10px; border-radius:999px; background:#38bdf8; flex:0 0 auto; box-shadow:0 0 14px rgba(56,189,248,.18); }
    .hist-dot.ultra{ background:#a855f7; box-shadow:0 0 14px rgba(168,85,247,.22); }
    .hist-dot.legendary{ background:#f97316; box-shadow:0 0 16px rgba(249,115,22,.25); }
    .hist-dot.hidden{ background:#cbd5e1; box-shadow:0 0 14px rgba(203,213,225,.18); }
    .hist-main{ display:flex; flex-direction:column; gap:1px; min-width:0; }
    .hist-line1{
      font-size:12px; font-weight:800; color:#f9fafb;
      display:flex; gap:8px; align-items:center; min-width:0;
    }
    .pill-mini{
      font-size:10px; letter-spacing:.12em; text-transform:uppercase;
      padding:4px 8px; border-radius:999px;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(2,6,23,.35);
      color:#e5e7eb; flex:0 0 auto;
    }
    .hist-line2{ font-size:11px; color:#9ca3af; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* Right preview booster */
    .card-zone{
      width:100%;
      min-height:420px;
      border-radius:28px;
      border:1px dashed rgba(148,163,184,.30);
      background:radial-gradient(circle at top,#0b1120,#020617 70%);
      display:flex; align-items:center; justify-content:center;
      padding:28px 16px;
      position:relative;
      overflow:hidden;
    }

    .booster-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:16px;
      align-items:center;
      justify-content:center;
      width:100%;
      max-width:100%;
      overflow:hidden;
    }
    @media (max-width: 980px){
      .booster-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 640px){
      .booster-grid{ grid-template-columns: 1fr; }
    }

    .card-frame{
      position:relative;
      width:100%;
      max-width:220px;
      height:330px;
      border-radius:24px;
      padding:2px;
      background:radial-gradient(circle at top,#22c55e,#064e3b 70%);
      box-shadow:0 0 36px rgba(34,197,94,.45);
      transition: transform .16s ease-out, box-shadow .16s ease-out;
      justify-self:center;
      min-width:0;
      cursor:pointer;
    }
    .card-frame[data-selected="true"]{
      box-shadow: 0 0 44px rgba(255,255,255,.10), 0 0 26px rgba(165,180,252,.22);
      transform: translateY(-2px);
    }
    .card-inner{ width:100%; height:100%; border-radius:22px; overflow:hidden; }

    /* âœ… Theme eau */
    .booster-closed[data-theme="water"]{
      background: radial-gradient(circle at 20% 0%, #38bdf8 0, #082f49 55%);
    }
    .booster-closed[data-theme="water"]::before{
      background: radial-gradient(circle at top left, rgba(186,230,253,.22), transparent 60%);
    }

    /* âœ… Theme feu */
    .booster-closed[data-theme="fire"]{
      background: radial-gradient(circle at 20% 0%, #fb7185 0, #7f1d1d 60%);
    }
    .booster-closed[data-theme="fire"]::before{
      background: radial-gradient(circle at top left, rgba(254,202,202,.20), transparent 60%);
    }

    /* Top bar */
    .top-bar{
      position:absolute;
      top:16px;
      left:50%;
      transform:translateX(-50%);
      width:100%;
      max-width:1200px;
      display:flex;
      justify-content:flex-end;
      align-items:center;
      padding:0 16px;
      pointer-events:none;
      z-index:50;
    }
    .top-right{ display:flex; align-items:center; gap:12px; pointer-events:auto; }
    .top-link{
      font-size:12px;
      padding:6px 10px;
      height:34px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.45);
      color:#e5e7eb;
      text-decoration:none;
      letter-spacing:.14em;
      text-transform:uppercase;
      background:rgba(15,23,42,.85);
    }
    .top-link:hover{ border-color:#a5b4fc; box-shadow:0 0 10px rgba(129,140,248,.4); }
    .top-link.glow{ border-color: rgba(165,180,252,.75); box-shadow: 0 0 14px rgba(129,140,248,.28); }
    #vs-logout-btn.top-link{ cursor:pointer; }

    /* Opening overlay */
    .open-overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      z-index:140;
      background:rgba(0,0,0,.62);
      backdrop-filter: blur(12px);
      padding:18px;
    }
    .open-overlay.on{ display:flex; }
    .open-modal{
      width:min(1180px, 98vw);
      border-radius:26px;
      border:1px solid rgba(148,163,184,.22);
      background:rgba(2,6,23,.90);
      box-shadow:0 0 44px rgba(0,0,0,.55);
      padding:18px;
      position:relative;
    }
    .open-top{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px; }
    .open-title{ font-size:12px; letter-spacing:.22em; text-transform:uppercase; color:#cbd5e1; font-weight:800; }
    .open-right{ display:flex; gap:10px; align-items:center; }
    .open-btn{
      border-radius:999px;
      padding:10px 14px;
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(15,23,42,.55);
      color:#e5e7eb;
      cursor:pointer;
    }
    .open-btn.primary{
      border:none;
      background: radial-gradient(circle at top left, #a855f7, #4f46e5);
      box-shadow: 0 0 18px rgba(168,85,247,.30);
    }
    .open-btn.close-glow{
      border-color: rgba(165,180,252,.75);
      box-shadow: 0 0 14px rgba(129,140,248,.28);
    }
    .open-btn:disabled{ opacity:.45; cursor:default; }

    /* Reel */
    .reel-section{ display:block; }
    .reel-section.hidden{ display:none; }
    .reel-viewport{
      position:relative;
      border-radius:22px;
      border:1px solid rgba(148,163,184,.20);
      background:radial-gradient(circle at top,#0b1120,#020617 70%);
      overflow:hidden;
      padding:18px 12px;
    }
    .reel-strip{ position:relative; height:188px; display:flex; align-items:center; }
    .reel-fade-left, .reel-fade-right{ position:absolute; top:0; bottom:0; width:140px; pointer-events:none; z-index:3; }
    .reel-fade-left{ left:0; background: linear-gradient(to right, rgba(2,6,23,.94), rgba(2,6,23,0)); }
    .reel-fade-right{ right:0; background: linear-gradient(to left, rgba(2,6,23,.94), rgba(2,6,23,0)); }
    .reel-cursor-line{
      position:absolute; left:50%; top:14px; transform:translateX(-50%);
      width:4px; height:126px;
      border-radius:999px;
      background: linear-gradient(to bottom, transparent, rgba(250,204,21,.95), transparent);
      box-shadow: 0 0 18px rgba(250,204,21,.55);
      z-index:4; pointer-events:none; opacity:.98;
    }
    .reel-track{ display:flex; align-items:center; gap:12px; will-change: transform; transform: translateX(0px); }

    /* Result-only */
    .result-section{ display:none; }
    .result-section.on{ display:block; }
    .result-wrap{ display:flex; align-items:center; justify-content:center; padding:8px 0; }
    .result-center{ width:min(420px, 92vw); display:flex; flex-direction:column; align-items:center; gap:10px; }
    .result-card{
      width:100%;
      border-radius:22px;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(2,6,23,.35);
      padding:10px;
    }
    .result-img{
      width:100%;
      aspect-ratio:3/4;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(148,163,184,.22);
      background:#020617;
      position:relative;
    }
    .result-img img{ width:100%; height:100%; object-fit:contain; object-position:center; display:block; padding:8px; background:#020617; }
    .result-meta{ margin-top:10px; display:flex; justify-content:space-between; align-items:flex-start; gap:10px; }
    .result-name{ font-size:12px; letter-spacing:.12em; text-transform:uppercase; font-weight:900; color:#f9fafb; }
    .result-sub{ margin-top:4px; font-size:12px; color:#9ca3af; line-height:1.35; white-space:pre-line; }
    .result-pill{
      font-size:11px; letter-spacing:.14em; text-transform:uppercase;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(2,6,23,.35);
      font-weight:900; white-space:nowrap;
    }
    .result-pill.epic{ color:#38bdf8; }
    .result-pill.ultra{ color:#a855f7; }
    .result-pill.legendary{ color:#f97316; }
    .result-profit{
      margin-top:10px;
      font-size:12px; font-weight:900;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(2,6,23,.35);
      padding:8px 10px;
      border-radius:999px;
      display:inline-flex;
      align-items:center; gap:8px;
      color:#e5e7eb;
    }
    .result-btnrow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; }

    /* Loot table */
    .drop-table{
      margin-top:10px;
      padding:16px 18px 18px;
      border-radius:24px;
      border:1px solid rgba(148,163,184,.22);
      background:radial-gradient(circle at top left,#020617,#020617 70%);
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .drop-title{ font-size:11px; letter-spacing:.18em; text-transform:uppercase; color:#9ca3af; text-align:center; }
    .drop-grid{ display:grid; grid-template-columns: repeat(7, 1fr); gap:14px; justify-items:center; }
    @media (max-width: 1080px){ .drop-grid{ grid-template-columns: repeat(6, 1fr); } }
    @media (max-width: 900px){ .drop-grid{ grid-template-columns: repeat(5, 1fr); } }
    @media (max-width: 740px){ .drop-grid{ grid-template-columns: repeat(4, 1fr); } }

    .drop-item{ width:92px; display:flex; flex-direction:column; align-items:center; gap:6px; text-align:center; cursor:pointer; user-select:none; }
    .drop-thumb{ width:78px; height:100px; border-radius:14px; overflow:hidden; border:1px solid rgba(148,163,184,.22); background:#020617; transition:transform .16s ease-out, box-shadow .16s ease-out; }
    .drop-thumb img{ width:100%; height:100%; object-fit:contain; object-position:center; display:block; padding:6px; background:#020617; }
    .drop-name{ font-size:10px; letter-spacing:.10em; text-transform:uppercase; color:#e5e7eb; }
    .drop-meta{ font-size:9px; color:#9ca3af; display:flex; flex-direction:column; gap:2px; }
    .drop-tag{ letter-spacing:.14em; text-transform:uppercase; font-weight:700; }
    .drop-tag.epic{ color:#38bdf8; }
    .drop-tag.ultra{ color:#a855f7; }
    .drop-tag.legendary{ color:#f97316; }

    .drop-item[data-rarity="EPIC"]:hover .drop-thumb{ transform:translateY(-2px) scale(1.04); box-shadow:0 0 14px rgba(56,189,248,.28); }
    .drop-item[data-rarity="ULTRA"]:hover .drop-thumb{ transform:translateY(-2px) scale(1.04); box-shadow:0 0 16px rgba(168,85,247,.30); }
    .drop-item[data-rarity="LEGENDARY"]:hover .drop-thumb{ transform:translateY(-2px) scale(1.04); box-shadow:0 0 18px rgba(249,115,22,.33); }

    /* Live loots column */
    .live-panel{
      background:radial-gradient(circle at top left,#020617,#020617 70%);
      border-radius:28px;
      border:1px solid rgba(148,163,184,.20);
      padding:18px 14px 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .live-head{ display:flex; flex-direction:column; gap:4px; }
    .live-title{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#f9fafb;
      font-weight:900;
    }
    .live-sub{ font-size:11px; color:#9ca3af; }
    .live-list{
      border-radius:18px;
      border:1px solid rgba(148,163,184,.14);
      background:rgba(2,6,23,.28);
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      height:510px;
      overflow:auto;
    }
    .live-empty{ font-size:12px; color:#9ca3af; padding:8px 6px; }
    .loot-item{
      display:flex;
      gap:10px;
      align-items:center;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.14);
      background:rgba(15,23,42,.28);
      padding:8px;
      position:relative;
      user-select:none;
    }
    .loot-thumb{
      width:56px;
      height:72px;
      border-radius:12px;
      overflow:hidden;
      border:1px solid rgba(148,163,184,.18);
      background:#020617;
      flex:0 0 auto;
    }
    .loot-thumb img{
      width:100%;
      height:100%;
      object-fit:contain;
      padding:6px;
      display:block;
    }
    .loot-meta{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
      flex:1;
    }
    .loot-line1{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      min-width:0;
    }
    .loot-user-link{
      font-size:11px;
      font-weight:900;
      color:#f9fafb;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      letter-spacing:.08em;
      text-transform:uppercase;
      text-decoration:none;
      cursor:pointer;
    }
    .loot-user-link:hover{ text-decoration:underline; opacity:.95; }
    .loot-pill{
      font-size:10px;
      letter-spacing:.12em;
      text-transform:uppercase;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.16);
      background:rgba(2,6,23,.35);
      font-weight:900;
      white-space:nowrap;
    }
    .loot-pill.epic{ color:#38bdf8; }
    .loot-pill.ultra{ color:#a855f7; }
    .loot-pill.legendary{ color:#f97316; }
    .loot-pill.hidden{ color:#cbd5e1; }
    .loot-line2{
      font-size:11px;
      color:#9ca3af;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .loot-line3{
      margin-top:2px;
      font-size:11px;
      color:#cbd5e1;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }

    /* Hidden FX */
    #result-imgwrap.fx-hidden{
      box-shadow: 0 0 0 1px rgba(203,213,225,.22), 0 0 26px rgba(203,213,225,.12) inset;
    }
    #result-imgwrap.fx-hidden::after{
      content:"";
      position:absolute;
      inset:-20%;
      background: radial-gradient(circle, rgba(203,213,225,.25) 0, rgba(203,213,225,0) 60%);
      mix-blend-mode: screen;
      opacity:.9;
      animation: hiddenPulse 900ms ease-out forwards;
      pointer-events:none;
    }
    @keyframes hiddenPulse{
      0%{ transform: scale(.7); opacity:0; }
      20%{ opacity:.9; }
      100%{ transform: scale(1.15); opacity:0; }
    }
  </style>
</head>
<body>

  <!-- Opening overlay -->
  <div class="open-overlay" id="open-overlay" aria-hidden="true">
    <div class="open-modal" role="dialog" aria-modal="true">
      <div class="open-top">
        <div>
          <div class="open-title" id="open-title">VAULTSPIN Â· OPENING</div>
        </div>
        <div class="open-right">
          <button class="open-btn" id="open-skip">Skip</button>
          <button class="open-btn close-glow" id="open-close">Close</button>
        </div>
      </div>

      <div class="reel-section" id="reel-section">
        <div class="reel-viewport" id="reel-viewport">
          <div class="reel-fade-left"></div>
          <div class="reel-fade-right"></div>
          <div class="reel-strip">
            <div class="reel-cursor-line"></div>
            <div class="reel-track" id="reel-track"></div>
          </div>
        </div>
        <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:10px;">
          <div style="font-size:12px; color:#9ca3af;" id="open-hint">Openingâ€¦</div>
          <div></div>
        </div>
      </div>

      <div class="result-section" id="result-section">
        <div class="result-wrap">
          <div class="result-center">
            <div class="result-card">
              <div class="result-img" id="result-imgwrap">
                <img id="result-img" src="" alt="Result" decoding="async" />
              </div>
              <div class="result-meta">
                <div>
                  <div class="result-name" id="result-name">â€”</div>
                  <div class="result-sub" id="result-desc">â€”</div>
                  <div class="result-profit" id="result-profit">Valeur : 0,00 â‚¬</div>
                </div>
                <div class="result-pill epic" id="result-pill">EPIC</div>
              </div>
            </div>

            <div class="result-btnrow">
              <button class="open-btn" id="result-sell" disabled title="Vente dÃ©sactivÃ©e (server-truth only)">Revendre</button>
              <button class="open-btn primary" id="result-open-another">Open another pack</button>
              <a class="top-link glow" href="collection.html" style="display:inline-flex; align-items:center; justify-content:center; padding:0 14px; height:34px;">
                Ma collection
              </a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Top bar -->
  <div class="top-bar">
    <div class="top-right">
      <a class="top-link glow" href="me.html">Profil</a>
      <a class="top-link glow" href="collection.html">Ma collection</a>
      <a class="top-link" href="leaderboard.html">Leaderboard</a>

      <!-- AUTH -->
      <span id="vs-user-email" class="top-link" style="display:none; max-width:220px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">â€”</span>
      <a id="vs-login-btn" class="top-link glow" href="login.html">Connexion</a>
      <button id="vs-logout-btn" class="top-link" style="display:none;">DÃ©connexion</button>
    </div>
  </div>

  <div class="page">
    <!-- COLONNE GAUCHE : Derniers loots -->
    <div class="live-panel">
      <div class="live-head">
        <div class="live-title">Derniers loots</div>
        <div class="live-sub">Global Â· temps rÃ©el</div>
      </div>

      <div class="live-list" id="vs-live-list">
        <div class="live-empty" id="vs-live-empty">Chargementâ€¦</div>
      </div>
    </div>

    <!-- LEFT -->
    <div class="left-panel">
      <div class="tag" style="align-self:flex-start;">VAULTSPIN Â· DÃ‰MO</div>
      <div><h1>Open your VaultSpin Pack</h1></div>

      <!-- âœ… (compat) select invisible pour pageIndex.js -->
      <select id="booster-select" style="display:none;">
        <option value="PLANT" selected>PLANT</option>
        <option value="WATER">WATER</option>
        <option value="FIRE">FIRE</option>
      </select>

      <div class="btn-row">
        <button id="open-pack-btn" class="btn-primary">Open VaultSpin Pack â€” 24,99 â‚¬</button>
        <button id="free-pack-btn" class="btn-primary btn-free" disabled>Booster gratuit â€” 2500 pts</button>
      </div>

      <div id="status-line" class="status-line">
        <span class="status-dot" id="status-dot"></span>
        <span id="status-text">PrÃªt. Ouvre un pack.</span>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="k">Packs opened</div>
          <div class="v" id="stat-opened">â€”</div>
          <div class="s">Total (serveur)</div>
        </div>
        <div class="stat">
          <div class="k">Spent</div>
          <div class="v" id="stat-spent">â€”</div>
          <div class="s">UI uniquement</div>
        </div>
        <div class="stat">
          <div class="k">Points</div>
          <div class="v" id="stat-points">0</div>
          <div class="s">+25 / pack</div>
        </div>
        <div class="stat">
          <div class="k">Vault value</div>
          <div class="v" id="stat-vault">â€”</div>
          <div class="s">Estimation (serveur)</div>
        </div>
        <div class="stat">
          <div class="k">Last pull</div>
          <div class="v" id="stat-last">â€”</div>
          <div class="s" id="stat-last-sub">â€”</div>
        </div>
        <div class="stat">
          <div class="k">Best pull</div>
          <div class="best-pull">
            <div class="best-thumb">
              <img id="stat-best-img" src="images/germignon.png" alt="Best" loading="lazy" decoding="async" />
            </div>
            <div class="best-meta">
              <div class="line1" id="stat-best-line1">â€”</div>
              <div class="line2" id="stat-best-line2">â€”</div>
            </div>
          </div>
        </div>
      </div>

      <div class="history">
        <div class="history-title">
          <span>Pack history</span>
          <button class="history-clear" id="clear-history" title="UI uniquement">Clear</button>
        </div>
        <div class="history-list" id="history-list">
          <div class="live-empty">Historique UI dÃ©sactivÃ© cÃ´tÃ© client (anti-cheat).</div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="right-panel">
      <div class="card-zone">
        <div class="booster-grid">

          <!-- Booster PLANTE -->
          <div class="card-frame" data-booster="PLANT" data-selected="true">
            <div class="card-inner">
              <div id="booster-closed" class="booster-closed booster-mode-idle" data-theme="plant">
                <div class="booster-label">
                  <div class="booster-leaf-icon">ðŸŒ¿</div>
                  <div class="booster-chip">VaultSpin Pack</div>
                  <div class="booster-title" id="booster-title">Booster Plante</div>
                  <div class="booster-subtitle" id="booster-subtitle">1 carte Ã  rÃ©vÃ©ler</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Booster EAU -->
          <div class="card-frame" data-booster="WATER" data-selected="false">
            <div class="card-inner">
              <div class="booster-closed booster-mode-idle" data-theme="water">
                <div class="booster-label">
                  <div class="booster-leaf-icon">ðŸ’§</div>
                  <div class="booster-chip">VaultSpin Pack</div>
                  <div class="booster-title">Booster Eau</div>
                  <div class="booster-subtitle">1 carte Ã  rÃ©vÃ©ler</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Booster FEU -->
          <div class="card-frame" data-booster="FIRE" data-selected="false">
            <div class="card-inner">
              <div class="booster-closed booster-mode-idle" data-theme="fire">
                <div class="booster-label">
                  <div class="booster-leaf-icon">ðŸ”¥</div>
                  <div class="booster-chip">VaultSpin Pack</div>
                  <div class="booster-title">Booster Feu</div>
                  <div class="booster-subtitle">1 carte Ã  rÃ©vÃ©ler</div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="drop-table">
        <div class="drop-title" id="drop-title">Cartes potentiellement obtenables (preview)</div>

        <!-- DROP GRID PLANTE -->
        <div class="drop-grid" id="drop-grid-plant">
          <div class="drop-item" data-rarity="EPIC" data-name="Germignon" data-img="images/germignon.png">
            <div class="drop-thumb"><img src="images/germignon.png" alt="Germignon" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Germignon</div>
            <div class="drop-meta"><span class="drop-tag epic">EPIC</span></div>
          </div>
          <div class="drop-item" data-rarity="EPIC" data-name="Astronelle" data-img="images/astronelle.png">
            <div class="drop-thumb"><img src="images/astronelle.png" alt="Astronelle" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Astronelle</div>
            <div class="drop-meta"><span class="drop-tag epic">EPIC</span></div>
          </div>
          <div class="drop-item" data-rarity="EPIC" data-name="Majaspic" data-img="images/majaspic.png">
            <div class="drop-thumb"><img src="images/majaspic.png" alt="Majaspic" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Majaspic</div>
            <div class="drop-meta"><span class="drop-tag epic">EPIC</span></div>
          </div>
          <div class="drop-item" data-rarity="EPIC" data-name="Chenipan" data-img="images/chenipan.png">
            <div class="drop-thumb"><img src="images/chenipan.png" alt="Chenipan" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Chenipan</div>
            <div class="drop-meta"><span class="drop-tag epic">EPIC</span></div>
          </div>
          <div class="drop-item" data-rarity="EPIC" data-name="Phyllali" data-img="images/phyllali.png">
            <div class="drop-thumb"><img src="images/phyllali.png" alt="Phyllali" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Phyllali</div>
            <div class="drop-meta"><span class="drop-tag epic">EPIC</span></div>
          </div>

          <div class="drop-item" data-rarity="ULTRA" data-name="Ã‰nergie Plante" data-img="images/energie_plante.png">
            <div class="drop-thumb"><img src="images/energie_plante.png" alt="Ã‰nergie Plante" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Ã‰nergie</div>
            <div class="drop-meta"><span class="drop-tag ultra">ULTRA</span></div>
          </div>
          <div class="drop-item" data-rarity="ULTRA" data-name="AÃ©romite" data-img="images/aeromite.png">
            <div class="drop-thumb"><img src="images/aeromite.png" alt="AÃ©romite" loading="lazy" decoding="async" /></div>
            <div class="drop-name">AÃ©romite</div>
            <div class="drop-meta"><span class="drop-tag ultra">ULTRA</span></div>
          </div>

          <div class="drop-item" data-rarity="LEGENDARY" data-name="Florizarre" data-img="images/florizarre.png">
            <div class="drop-thumb"><img src="images/florizarre.png" alt="Florizarre" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Florizarre</div>
            <div class="drop-meta"><span class="drop-tag legendary">LEGENDARY</span></div>
          </div>
        </div>

        <!-- DROP GRID EAU -->
        <div class="drop-grid" id="drop-grid-water" style="display:none;">
          <div class="drop-item" data-rarity="EPIC" data-name="Aquali" data-img="images/aquali.png">
            <div class="drop-thumb"><img src="images/aquali.png" alt="Aquali" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Aquali</div>
            <div class="drop-meta"><span class="drop-tag epic">EPIC</span></div>
          </div>
          <div class="drop-item" data-rarity="ULTRA" data-name="Flobio" data-img="images/flobio.png">
            <div class="drop-thumb"><img src="images/flobio.png" alt="Flobio" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Flobio</div>
            <div class="drop-meta"><span class="drop-tag ultra">ULTRA</span></div>
          </div>
          <div class="drop-item" data-rarity="LEGENDARY" data-name="Tortank" data-img="images/tortank.png">
            <div class="drop-thumb"><img src="images/tortank.png" alt="Tortank" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Tortank</div>
            <div class="drop-meta"><span class="drop-tag legendary">LEGENDARY</span></div>
          </div>
        </div>

        <!-- DROP GRID FEU -->
        <div class="drop-grid" id="drop-grid-fire" style="display:none;">
          <div class="drop-item" data-rarity="EPIC" data-name="Dracaufeu EX" data-img="images/dracaufeu_ex.png">
            <div class="drop-thumb"><img src="images/dracaufeu_ex.png" alt="Dracaufeu EX" loading="lazy" decoding="async" /></div>
            <div class="drop-name">EX</div>
            <div class="drop-meta"><span class="drop-tag epic">EPIC</span></div>
          </div>
          <div class="drop-item" data-rarity="ULTRA" data-name="Dracaufeu VMAX" data-img="images/dracaufeu_vmax.png">
            <div class="drop-thumb"><img src="images/dracaufeu_vmax.png" alt="Dracaufeu VMAX" loading="lazy" decoding="async" /></div>
            <div class="drop-name">VMAX</div>
            <div class="drop-meta"><span class="drop-tag ultra">ULTRA</span></div>
          </div>
          <div class="drop-item" data-rarity="LEGENDARY" data-name="Dracaufeu" data-img="images/dracaufeu.png">
            <div class="drop-thumb"><img src="images/dracaufeu.png" alt="Dracaufeu" loading="lazy" decoding="async" /></div>
            <div class="drop-name">Drac.</div>
            <div class="drop-meta"><span class="drop-tag legendary">LEGENDARY</span></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Sounds (utilisÃ©s par BoosterEngine) -->
  <audio id="sfx-booster" src="sounds/booster_open.mp3" preload="auto"></audio>
  <audio id="sfx-reveal" src="sounds/card_reveal.mp3" preload="auto"></audio>
  <audio id="sfx-legendary" src="sounds/legendary_fx.mp3" preload="auto"></audio>
  <audio id="sfx-tick" src="sounds/clic_clic.mp3" preload="auto"></audio>

  <!-- âœ… Le pack opening â€œsafeâ€ est dans js/pageIndex.js -->
  <script type="module" src="./js/pageIndex.js"></script>

  <!-- âœ… UI glue: booster selection + switch drop grids + preview (UI only) -->
  <script type="module">
    const select = document.getElementById("booster-select");

    function setSelected(key){
      const k = String(key || "PLANT").toUpperCase();
      if (select) {
        select.value = k;
        select.dispatchEvent(new Event("change", { bubbles: true }));
      }

      document.querySelectorAll(".card-frame[data-booster]").forEach(el => {
        el.setAttribute("data-selected", String(el.getAttribute("data-booster") === k));
      });

      const gPlant = document.getElementById("drop-grid-plant");
      const gWater = document.getElementById("drop-grid-water");
      const gFire  = document.getElementById("drop-grid-fire");
      if (gPlant) gPlant.style.display = (k === "PLANT") ? "" : "none";
      if (gWater) gWater.style.display = (k === "WATER") ? "" : "none";
      if (gFire)  gFire.style.display  = (k === "FIRE")  ? "" : "none";
    }

    document.addEventListener("DOMContentLoaded", () => {
      setSelected("PLANT");

      document.querySelectorAll(".card-frame[data-booster]").forEach(el => {
        el.addEventListener("click", () => setSelected(el.getAttribute("data-booster")));
      });

      // preview hover (UI only)
      const box = document.createElement("div");
      box.style.position = "fixed";
      box.style.right = "28px";
      box.style.top = "50%";
      box.style.transform = "translateY(-50%)";
      box.style.width = "320px";
      box.style.aspectRatio = "3/4";
      box.style.borderRadius = "18px";
      box.style.overflow = "hidden";
      box.style.background = "rgba(2,6,23,.90)";
      box.style.border = "1px solid rgba(148,163,184,.22)";
      box.style.boxShadow = "0 0 30px rgba(0,0,0,.6)";
      box.style.opacity = "0";
      box.style.pointerEvents = "none";
      box.style.transition = "opacity .12s ease";
      box.style.zIndex = "120";
      box.innerHTML = `
        <img id="pf-img" src="" alt="Preview" style="width:100%;height:100%;object-fit:contain;background:#020617;padding:8px;display:block;" />
        <div style="position:absolute;left:10px;right:10px;bottom:10px;display:flex;justify-content:space-between;gap:10px;align-items:center;">
          <div id="pf-name" style="font-size:11px;letter-spacing:.12em;text-transform:uppercase;font-weight:900;color:#e5e7eb;padding:6px 10px;border-radius:999px;border:1px solid rgba(148,163,184,.16);background:rgba(2,6,23,.45);max-width:70%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">â€”</div>
          <div id="pf-tag" style="font-size:11px;letter-spacing:.14em;text-transform:uppercase;padding:6px 10px;border-radius:999px;border:1px solid rgba(148,163,184,.16);background:rgba(2,6,23,.45);font-weight:900;">EPIC</div>
        </div>
      `;
      document.body.appendChild(box);

      const imgEl = box.querySelector("#pf-img");
      const nameEl = box.querySelector("#pf-name");
      const tagEl = box.querySelector("#pf-tag");

      function showPreview(img, name, rarity){
        imgEl.src = img || "";
        nameEl.textContent = name || "â€”";
        tagEl.textContent = rarity || "EPIC";
        box.style.opacity = "1";
      }
      function hidePreview(){
        box.style.opacity = "0";
      }

      document.querySelectorAll(".drop-item").forEach(el => {
        let t = null;
        const img = el.getAttribute("data-img");
        const name = el.getAttribute("data-name");
        const rarity = el.getAttribute("data-rarity");
        el.addEventListener("mouseenter", () => {
          t = setTimeout(() => showPreview(img, name, rarity), 90);
        });
        el.addEventListener("mouseleave", () => {
          if (t) clearTimeout(t);
          hidePreview();
        });
      });
    });
  </script>

  <!-- âœ… AUTH + points READ (pas dâ€™ajout, pas de spend cÃ´tÃ© front) -->
  <script type="module">
    import { supabase } from "./js/supabaseClient.js";

    const loginBtn = document.getElementById("vs-login-btn");
    const logoutBtn = document.getElementById("vs-logout-btn");
    const emailEl = document.getElementById("vs-user-email");
    const freeBtn = document.getElementById("free-pack-btn");
    const statPoints = document.getElementById("stat-points");

    const FREE_PACK_COST_PTS = 2500;

    function setAuthed(label){
      if (emailEl){
        emailEl.style.display = "inline-flex";
        emailEl.textContent = label || "ConnectÃ©";
      }
      if (loginBtn) loginBtn.style.display = "none";
      if (logoutBtn) logoutBtn.style.display = "inline-flex";
    }
    function setNotAuthed(){
      if (emailEl){
        emailEl.style.display = "none";
        emailEl.textContent = "â€”";
      }
      if (loginBtn) loginBtn.style.display = "inline-flex";
      if (logoutBtn) logoutBtn.style.display = "none";
      if (freeBtn) freeBtn.disabled = true;
      if (statPoints) statPoints.textContent = "0";
    }

    async function setAuthedFromSession(session){
      const { data } = await supabase
        .from("profiles")
        .select("username, display_name")
        .eq("id", session.user.id)
        .maybeSingle();

      const label = (data?.display_name || data?.username || session.user.email || "ConnectÃ©");
      setAuthed(label);
    }

    async function requireAuthOrRedirect(){
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user){
        window.location.href = "login.html";
        return null;
      }
      try{
        const { data } = await supabase
          .from("profiles")
          .select("username")
          .eq("id", session.user.id)
          .maybeSingle();
        if (!data?.username){
          window.location.href = "profile.html?next=./index.html";
          return null;
        }
      }catch(_){}
      return session;
    }

    // READ points server
    async function vsGetPoints(){
      const { data, error } = await supabase.rpc("vs_get_points", {});
      if (error) throw error;
      return Number(data || 0);
    }

    async function refreshPointsUI(){
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) return;

      try{
        const pts = await vsGetPoints();
        if (statPoints) statPoints.textContent = pts.toLocaleString("fr-FR");
        if (freeBtn){
          freeBtn.disabled = !(pts >= FREE_PACK_COST_PTS);
          freeBtn.textContent = (pts >= FREE_PACK_COST_PTS)
            ? `Booster gratuit â€” ${FREE_PACK_COST_PTS} pts`
            : `Booster gratuit â€” ${FREE_PACK_COST_PTS} pts (${pts}/${FREE_PACK_COST_PTS})`;
        }
      }catch(e){
        console.warn("refreshPointsUI failed:", e);
      }
    }

    // Boot
    const { data: { session } } = await supabase.auth.getSession();
    if (session?.user){
      await setAuthedFromSession(session);
      await refreshPointsUI();
      setInterval(refreshPointsUI, 6000);
    } else {
      setNotAuthed();
    }

    supabase.auth.onAuthStateChange(async (_event, newSession) => {
      if (newSession?.user){
        await setAuthedFromSession(newSession);
        await refreshPointsUI();
      } else {
        setNotAuthed();
      }
    });

    logoutBtn?.addEventListener("click", async () => {
      await supabase.auth.signOut();
    });

    // Gate clicks (auth required)
    document.getElementById("open-pack-btn")?.addEventListener("click", async (e) => {
      const s = await requireAuthOrRedirect();
      if (!s){ e.preventDefault(); e.stopImmediatePropagation(); }
    }, true);

    document.getElementById("free-pack-btn")?.addEventListener("click", async (e) => {
      const s = await requireAuthOrRedirect();
      if (!s){ e.preventDefault(); e.stopImmediatePropagation(); }
    }, true);
  </script>

  <!-- âœ… LIVE LOOTS (inchangÃ©, DB read only) -->
  <script type="module">
    import { supabase } from "./js/supabaseClient.js";

    const listEl = document.getElementById("vs-live-list");

    function fmtEur(n){
      return (Number(n)||0).toLocaleString("fr-FR", { minimumFractionDigits:2, maximumFractionDigits:2 }) + " â‚¬";
    }
    function fmtTime(ts){
      const d = new Date(ts);
      return d.toLocaleString("fr-FR", { day:"2-digit", month:"2-digit", hour:"2-digit", minute:"2-digit" });
    }
    function pillClass(rk){
      const k = String(rk || "").toUpperCase();
      if (k === "LEGENDARY") return "legendary";
      if (k === "ULTRA") return "ultra";
      if (k === "HIDDEN") return "hidden";
      return "epic";
    }
    function escapeHtml(s){
      return String(s || "").replace(/[&<>"']/g, (c) => ({
        "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#039;"
      }[c]));
    }
    function safeName(p){
      return (p?.display_name || p?.username || p?.email || "Player");
    }

    async function fetchLatestLoots(limit = 30){
      const { data, error } = await supabase
        .from("user_cards")
        .select(`
          id,
          user_id,
          card_type_index,
          rarity_key,
          image_url,
          card_name,
          estimated_value_eur,
          opened_at,
          profiles:profiles!user_cards_user_id_fkey(display_name, username, email)
        `)
        .order("opened_at", { ascending: false })
        .limit(limit);

      if (error) throw error;

      return (data || []).map(x => ({
        id: x.id,
        user_id: x.user_id,
        opened_at: x.opened_at,
        img: x.image_url,
        name: x.card_name || ("Card ct " + x.card_type_index),
        rarity: (x.rarity_key || "EPIC").toUpperCase(),
        value: Number(x.estimated_value_eur || 0),
        player: safeName(x.profiles)
      }));
    }

    function renderItems(items){
      if (!listEl) return;
      listEl.innerHTML = "";

      if (!items.length){
        listEl.innerHTML = `<div class="live-empty">Aucun loot pour le moment.</div>`;
        return;
      }

      for (const it of items){
        const row = document.createElement("div");
        row.className = "loot-item";
        row.innerHTML = `
          <div class="loot-thumb">
            <img src="${String(it.img || "").replace(/"/g,"&quot;")}" alt="loot"/>
          </div>
          <div class="loot-meta">
            <div class="loot-line1">
              <a class="loot-user-link" href="player.html?u=${encodeURIComponent(it.user_id)}">
                ${escapeHtml(it.player)}
              </a>
              <div class="loot-pill ${pillClass(it.rarity)}">${escapeHtml(it.rarity)}</div>
            </div>
            <div class="loot-line2">${escapeHtml(it.name)}</div>
            <div class="loot-line3">
              <span>${fmtEur(it.value)}</span>
              <span>${fmtTime(it.opened_at)}</span>
            </div>
          </div>
        `;
        listEl.appendChild(row);
      }
    }

    let lastTopId = null;

    async function refreshLatest(){
      try{
        const items = await fetchLatestLoots(30);
        const topId = items[0]?.id ? String(items[0].id) : null;
        const isNewTop = topId && topId !== lastTopId;

        renderItems(items);

        if (isNewTop){
          listEl.scrollTop = 0;
        }
        lastTopId = topId;
      }catch(err){
        console.error("Live feed error:", err);
        if (listEl && listEl.children.length === 0){
          listEl.innerHTML = `<div class="live-empty">Erreur feed (voir console).</div>`;
        }
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await refreshLatest();
      setInterval(refreshLatest, 4000);
    });
  </script>

</body>
</html>
